import{_ as E,r as b,c as d,a as t,t as m,b as f,d as c,C as J,v as p,o as s,n as te,k as R,x as oe,F as B,q as T,h as V,p as L,w as G,D as re,f as N,e as le,m as ye,l as ke}from"./admin-BwCgjLDK.js";import{b as O,a as j,c as W,d as se}from"./api-DccBIR6h.js";import{S}from"./sweetalert2.esm.all-C0u8rGqG.js";import ne from"./Media-4zwlHndv.js";const we={name:"ConsultationDetail",props:{consultation:{type:Object,required:!0},botId:{type:[String,Number],required:!0}},emits:["close","updated"],setup(n,{emit:e}){const i=b(!1),o=b({status:n.consultation.status,admin_notes:n.consultation.admin_notes||""});return{form:o,saving:i,saveConsultation:async()=>{i.value=!0;try{const r=await O(`/bot-management/${n.botId}/consultations/${n.consultation.id}`,o.value);if(!r.ok){const l=await r.json().catch(()=>({}));throw new Error(l.message||"–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è")}await S.fire({title:"–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ",icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"}),e("updated"),e("close")}catch(r){S.fire({title:"–û—à–∏–±–∫–∞",text:r.message||"–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è",icon:"error",confirmButtonText:"–û–ö"})}finally{i.value=!1}},formatDate:r=>new Date(r).toLocaleString("ru-RU")}}},he={class:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4"},Ce={class:"bg-background border border-border rounded-lg shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto"},Me={class:"sticky top-0 bg-background border-b border-border p-6"},Se={class:"flex items-center justify-between"},De={class:"text-lg font-semibold"},Fe={class:"p-6 space-y-6"},Ue={key:0},Ve={class:"bg-muted/30 rounded-lg p-4"},Be={class:"text-sm"},Te={key:0,class:"text-sm"},Ie={key:1,class:"text-sm"},je={class:"space-y-3"},Ee={class:"text-sm"},qe={class:"text-sm"},Pe={key:0},ze={class:"text-sm whitespace-pre-wrap"},Ae={class:"text-sm"},Ne={class:"flex gap-2 pt-4 border-t border-border"},Le=["disabled"];function Oe(n,e,i,o,v,k){return s(),d("div",he,[t("div",Ce,[t("div",Me,[t("div",Se,[t("h3",De,"–î–µ—Ç–∞–ª–∏ –∑–∞—è–≤–∫–∏ #"+m(i.consultation.id),1),t("button",{onClick:e[0]||(e[0]=r=>n.$emit("close")),class:"text-muted-foreground hover:text-foreground"}," ‚úï ")])]),t("div",Fe,[i.consultation.user?(s(),d("div",Ue,[e[5]||(e[5]=t("h4",{class:"text-sm font-medium text-muted-foreground mb-2"},"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å",-1)),t("div",Ve,[t("p",Be,"ID: "+m(i.consultation.user.telegram_user_id),1),i.consultation.user.username?(s(),d("p",Te,"@"+m(i.consultation.user.username),1)):f("",!0),i.consultation.user.first_name?(s(),d("p",Ie,m(i.consultation.user.first_name)+" "+m(i.consultation.user.last_name||""),1)):f("",!0)])])):f("",!0),t("div",null,[e[13]||(e[13]=t("h4",{class:"text-sm font-medium text-muted-foreground mb-2"},"–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞—è–≤–∫–µ",-1)),t("div",je,[t("div",null,[e[6]||(e[6]=t("label",{class:"block text-xs text-muted-foreground mb-1"},"–ò–º—è",-1)),t("p",Ee,m(i.consultation.name),1)]),t("div",null,[e[7]||(e[7]=t("label",{class:"block text-xs text-muted-foreground mb-1"},"–¢–µ–ª–µ—Ñ–æ–Ω",-1)),t("p",qe,m(i.consultation.phone),1)]),i.consultation.description?(s(),d("div",Pe,[e[8]||(e[8]=t("label",{class:"block text-xs text-muted-foreground mb-1"},"–û–ø–∏—Å–∞–Ω–∏–µ",-1)),t("p",ze,m(i.consultation.description),1)])):f("",!0),t("div",null,[e[10]||(e[10]=t("label",{class:"block text-xs text-muted-foreground mb-1"},"–°—Ç–∞—Ç—É—Å",-1)),c(t("select",{"onUpdate:modelValue":e[1]||(e[1]=r=>o.form.status=r),class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},[...e[9]||(e[9]=[t("option",{value:"new"},"–ù–æ–≤–∞—è",-1),t("option",{value:"in_progress"},"–í —Ä–∞–±–æ—Ç–µ",-1),t("option",{value:"closed"},"–ó–∞–∫—Ä—ã—Ç–∞",-1)])],512),[[J,o.form.status]])]),t("div",null,[e[11]||(e[11]=t("label",{class:"block text-xs text-muted-foreground mb-1"},"–ü—Ä–∏–º–µ—á–∞–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞",-1)),c(t("textarea",{"onUpdate:modelValue":e[2]||(e[2]=r=>o.form.admin_notes=r),rows:"4",class:"w-full px-3 py-2 border border-border rounded-lg bg-background resize-none",placeholder:"–í–≤–µ–¥–∏—Ç–µ –ø—Ä–∏–º–µ—á–∞–Ω–∏—è..."},null,512),[[p,o.form.admin_notes]])]),t("div",null,[e[12]||(e[12]=t("label",{class:"block text-xs text-muted-foreground mb-1"},"–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è",-1)),t("p",Ae,m(o.formatDate(i.consultation.created_at)),1)])])]),t("div",Ne,[t("button",{onClick:e[3]||(e[3]=r=>n.$emit("close")),class:"flex-1 h-10 px-4 border border-border bg-background/50 hover:bg-accent/10 rounded-lg"}," –û—Ç–º–µ–Ω–∞ "),t("button",{onClick:e[4]||(e[4]=(...r)=>o.saveConsultation&&o.saveConsultation(...r)),disabled:o.saving,class:"flex-1 h-10 px-4 bg-accent/10 backdrop-blur-xl text-accent border border-accent/40 hover:bg-accent/20 rounded-lg disabled:opacity-50"},m(o.saving?"–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...":"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"),9,Le)])])])])}const Re=E(we,[["render",Oe]]),Ge={name:"ConsultationTable",components:{ConsultationDetail:Re},props:{botId:{type:[String,Number],required:!0}},setup(n){const e=b(!1),i=b([]),o=b(null),v=b(1),k=b(20),r=b(0),l=b({status:"",date_from:"",date_to:""}),y=async()=>{e.value=!0;try{const C={page:v.value,per_page:k.value,...l.value},I=await j(`/bot-management/${n.botId}/consultations`,C);if(!I.ok)throw new Error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞—è–≤–æ–∫");const q=await I.json();i.value=q.data.consultations||[],r.value=q.data.total||0}catch(C){console.error("Error fetching consultations:",C)}finally{e.value=!1}},x=()=>{l.value={status:"",date_from:"",date_to:""},v.value=1,y()},w=C=>{o.value=C},u=C=>({new:"–ù–æ–≤–∞—è",in_progress:"–í —Ä–∞–±–æ—Ç–µ",closed:"–ó–∞–∫—Ä—ã—Ç–∞"})[C]||C,a=C=>({new:"bg-blue-500/10 text-blue-500",in_progress:"bg-yellow-500/10 text-yellow-500",closed:"bg-green-500/10 text-green-500"})[C]||"bg-gray-500/10 text-gray-500",M=C=>new Date(C).toLocaleDateString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"});return te(v,()=>{y()}),R(()=>{y()}),{loading:e,consultations:i,selectedConsultation:o,currentPage:v,perPage:k,total:r,filters:l,fetchConsultations:y,resetFilters:x,showDetail:w,getStatusLabel:u,getStatusClass:a,formatDate:M}}},He={class:"consultation-table space-y-4"},Ke={class:"bg-muted/30 rounded-lg border border-border p-4"},Qe={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},Je={class:"flex items-end"},We={key:0,class:"text-center py-12"},Xe={key:1,class:"bg-background rounded-lg border border-border overflow-hidden"},Ye={class:"overflow-x-auto"},Ze={class:"w-full"},$e={class:"divide-y divide-border"},et={class:"px-6 py-4 text-sm"},tt={class:"px-6 py-4 text-sm"},ot={class:"px-6 py-4 text-sm"},rt={class:"px-6 py-4"},lt={class:"px-6 py-4 text-sm"},st={class:"px-6 py-4 text-right"},nt=["onClick"],dt={key:0,class:"px-6 py-4 border-t border-border flex items-center justify-between"},at={class:"text-sm text-muted-foreground"},it={class:"flex gap-2"},ut=["disabled"],mt=["disabled"];function bt(n,e,i,o,v,k){const r=V("ConsultationDetail");return s(),d("div",He,[e[16]||(e[16]=t("div",{class:"flex items-center justify-between"},[t("h2",{class:"text-2xl font-semibold"},"–ó–∞—è–≤–∫–∏ –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é")],-1)),t("div",Ke,[t("div",Qe,[t("div",null,[e[11]||(e[11]=t("label",{class:"block text-sm font-medium mb-2"},"–°—Ç–∞—Ç—É—Å",-1)),c(t("select",{"onUpdate:modelValue":e[0]||(e[0]=l=>o.filters.status=l),onChange:e[1]||(e[1]=(...l)=>o.fetchConsultations&&o.fetchConsultations(...l)),class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},[...e[10]||(e[10]=[t("option",{value:""},"–í—Å–µ",-1),t("option",{value:"new"},"–ù–æ–≤—ã–µ",-1),t("option",{value:"in_progress"},"–í —Ä–∞–±–æ—Ç–µ",-1),t("option",{value:"closed"},"–ó–∞–∫—Ä—ã—Ç—ã–µ",-1)])],544),[[J,o.filters.status]])]),t("div",null,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium mb-2"},"–î–∞—Ç–∞ –æ—Ç",-1)),c(t("input",{"onUpdate:modelValue":e[2]||(e[2]=l=>o.filters.date_from=l),type:"date",onChange:e[3]||(e[3]=(...l)=>o.fetchConsultations&&o.fetchConsultations(...l)),class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},null,544),[[p,o.filters.date_from]])]),t("div",null,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium mb-2"},"–î–∞—Ç–∞ –¥–æ",-1)),c(t("input",{"onUpdate:modelValue":e[4]||(e[4]=l=>o.filters.date_to=l),type:"date",onChange:e[5]||(e[5]=(...l)=>o.fetchConsultations&&o.fetchConsultations(...l)),class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},null,544),[[p,o.filters.date_to]])]),t("div",Je,[t("button",{onClick:e[6]||(e[6]=(...l)=>o.resetFilters&&o.resetFilters(...l)),class:"w-full h-10 px-4 border border-border bg-background hover:bg-muted/10 rounded-lg"}," –°–±—Ä–æ—Å–∏—Ç—å ")])])]),o.loading?(s(),d("div",We,[...e[14]||(e[14]=[t("p",{class:"text-muted-foreground"},"–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞—è–≤–æ–∫...",-1)])])):f("",!0),o.loading?f("",!0):(s(),d("div",Xe,[t("div",Ye,[t("table",Ze,[e[15]||(e[15]=t("thead",{class:"bg-muted/30 border-b border-border"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase"},"ID"),t("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase"},"–ò–º—è"),t("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase"},"–¢–µ–ª–µ—Ñ–æ–Ω"),t("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase"},"–°—Ç–∞—Ç—É—Å"),t("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase"},"–î–∞—Ç–∞"),t("th",{class:"px-6 py-3 text-right text-xs font-medium uppercase"},"–î–µ–π—Å—Ç–≤–∏—è")])],-1)),t("tbody",$e,[(s(!0),d(B,null,T(o.consultations,l=>(s(),d("tr",{key:l.id,class:"hover:bg-muted/10"},[t("td",et,m(l.id),1),t("td",tt,m(l.name),1),t("td",ot,m(l.phone),1),t("td",rt,[t("span",{class:L(["px-2 py-1 text-xs rounded-md",o.getStatusClass(l.status)])},m(o.getStatusLabel(l.status)),3)]),t("td",lt,m(o.formatDate(l.created_at)),1),t("td",st,[t("button",{onClick:y=>o.showDetail(l),class:"px-3 py-1 text-xs bg-blue-500 hover:bg-blue-600 text-white rounded"}," –î–µ—Ç–∞–ª–∏ ",8,nt)])]))),128))])])]),o.total>o.perPage?(s(),d("div",dt,[t("div",at," –ü–æ–∫–∞–∑–∞–Ω–æ "+m((o.currentPage-1)*o.perPage+1)+" - "+m(Math.min(o.currentPage*o.perPage,o.total))+" –∏–∑ "+m(o.total),1),t("div",it,[t("button",{onClick:e[7]||(e[7]=l=>o.currentPage--),disabled:o.currentPage===1,class:"px-4 py-2 border border-border rounded-lg disabled:opacity-50"}," –ù–∞–∑–∞–¥ ",8,ut),t("button",{onClick:e[8]||(e[8]=l=>o.currentPage++),disabled:o.currentPage*o.perPage>=o.total,class:"px-4 py-2 border border-border rounded-lg disabled:opacity-50"}," –í–ø–µ—Ä–µ–¥ ",8,mt)])])):f("",!0)])),o.selectedConsultation?(s(),oe(r,{key:2,consultation:o.selectedConsultation,"bot-id":i.botId,onClose:e[9]||(e[9]=l=>o.selectedConsultation=null),onUpdated:o.fetchConsultations},null,8,["consultation","bot-id","onUpdated"])):f("",!0)])}const ct=E(Ge,[["render",bt]]),gt={name:"MaterialForm",props:{botId:{type:[String,Number],required:!0},categoryId:{type:[String,Number],default:null},material:{type:Object,default:null}},emits:["close","saved"],setup(n,{emit:e}){const i=b(!1),o=b(!1),v=b(!1),k=b(""),r=b([]),l=b(null),y=b(null),x=b(null),w=b(!!n.material),u=b([]),a=b({title:"",category_id:n.categoryId||null,description:"",file_type:"file",file_url:"",file_id:"",media_id:null,order_index:0,is_active:!0}),M=async()=>{try{const _=await j(`/bot-management/${n.botId}/materials/categories`);if(_.ok){const D=await _.json();u.value=D.data||[]}}catch(_){console.error("Error fetching categories:",_)}},C=async()=>{o.value=!0;try{const _={};k.value&&(_.search=k.value);const D=await j("/media",_);if(D.ok){const U=await D.json();r.value=U.data||[]}}catch(_){console.error("Error fetching media:",_)}finally{o.value=!1}},I=()=>{a.value.file_url="",a.value.file_id="",a.value.media_id=null,l.value=null,y.value=null},q=_=>{const D=_.target.files[0];D&&(l.value=D,a.value.media_id=null,y.value=null)},X=_=>{a.value.media_id=_.id,y.value=_,l.value=null},Y=()=>{a.value.media_id&&(v.value=!1)},Z=_=>{if(!_)return"0 B";const D=1024,U=["B","KB","MB","GB"],H=Math.floor(Math.log(_)/Math.log(D));return Math.round(_/Math.pow(D,H)*100)/100+" "+U[H]},$=async()=>{i.value=!0;try{const _=new FormData;if(_.append("title",a.value.title),_.append("category_id",a.value.category_id),_.append("description",a.value.description||""),_.append("file_type",a.value.file_type),_.append("order_index",a.value.order_index||0),_.append("is_active",a.value.is_active?1:0),a.value.file_type==="file")if(l.value)_.append("file",l.value);else if(a.value.media_id)_.append("media_id",a.value.media_id);else throw new Error("–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª –∏–ª–∏ —É–∫–∞–∑–∞—Ç—å —Ñ–∞–π–ª –∏–∑ –º–µ–¥–∏–∞-–±–∏–±–ª–∏–æ—Ç–µ–∫–∏");else a.value.file_type==="url"?_.append("file_url",a.value.file_url):a.value.file_type==="telegram_file_id"&&_.append("file_id",a.value.file_id);let D;if(w.value?D=await O(`/bot-management/${n.botId}/materials/${n.material.id}`,_):D=await W(`/bot-management/${n.botId}/materials`,_),!D.ok){const U=await D.json().catch(()=>({}));throw new Error(U.message||"–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–∞")}await S.fire({title:"–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ",icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"}),e("saved"),e("close")}catch(_){S.fire({title:"–û—à–∏–±–∫–∞",text:_.message||"–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–∞",icon:"error",confirmButtonText:"–û–ö"})}finally{i.value=!1}};return n.material&&(a.value={title:n.material.title||"",category_id:n.material.category_id||n.categoryId||null,description:n.material.description||"",file_type:n.material.file_type||"file",file_url:n.material.file_url||"",file_id:n.material.file_id||"",media_id:n.material.media_id||null,order_index:n.material.order_index||0,is_active:n.material.is_active!==void 0?n.material.is_active:!0},n.material.media&&(y.value=n.material.media)),te(v,_=>{_&&C()}),te(k,()=>{v.value&&C()}),R(()=>{M()}),{saving:i,loadingMedia:o,showMediaPicker:v,mediaSearch:k,mediaFiles:r,selectedFile:l,selectedMedia:y,fileInput:x,isEditMode:w,categories:u,form:a,fetchMediaFiles:C,handleFileTypeChange:I,handleFileSelect:q,selectMedia:X,confirmMediaSelection:Y,formatFileSize:Z,saveMaterial:$}}},ft={class:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4"},xt={class:"bg-background border border-border rounded-lg shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-y-auto"},vt={class:"sticky top-0 bg-background border-b border-border p-6"},pt={class:"flex items-center justify-between"},_t={class:"text-lg font-semibold"},yt=["value"],kt={key:0},wt={class:"space-y-3"},ht={key:0,class:"text-xs text-muted-foreground mt-1"},Ct={key:0,class:"text-xs text-muted-foreground mt-1"},Mt={key:1},St={key:2},Dt={class:"flex items-center gap-2"},Ft={class:"flex gap-4 pt-4 border-t border-border"},Ut=["disabled"],Vt={key:0,class:"fixed inset-0 z-[60] flex items-center justify-center bg-black/90 p-4"},Bt={class:"bg-background border border-border rounded-lg shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col"},Tt={class:"p-6 border-b border-border"},It={class:"flex items-center justify-between"},jt={class:"flex-1 overflow-y-auto p-6"},Et={key:0,class:"text-center py-12"},qt={key:1,class:"text-center py-12 text-muted-foreground"},Pt={key:2,class:"grid grid-cols-2 md:grid-cols-4 gap-4"},zt=["onClick"],At={class:"text-sm font-medium truncate"},Nt={class:"text-xs text-muted-foreground mt-1"},Lt={class:"p-6 border-t border-border"},Ot=["disabled"];function Rt(n,e,i,o,v,k){return s(),d("div",ft,[t("div",xt,[t("div",vt,[t("div",pt,[t("h3",_t,m(o.isEditMode?"–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª":"–°–æ–∑–¥–∞—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª"),1),t("button",{onClick:e[0]||(e[0]=r=>n.$emit("close")),class:"text-muted-foreground hover:text-foreground"}," ‚úï ")])]),t("form",{onSubmit:e[13]||(e[13]=G((...r)=>o.saveMaterial&&o.saveMaterial(...r),["prevent"])),class:"p-6 space-y-6"},[t("div",null,[e[17]||(e[17]=t("label",{class:"block text-sm font-medium mb-2"},"–ù–∞–∑–≤–∞–Ω–∏–µ *",-1)),c(t("input",{"onUpdate:modelValue":e[1]||(e[1]=r=>o.form.title=r),type:"text",required:"",placeholder:"–ù–∞–∑–≤–∞–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–∞",class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},null,512),[[p,o.form.title]])]),t("div",null,[e[19]||(e[19]=t("label",{class:"block text-sm font-medium mb-2"},"–ö–∞—Ç–µ–≥–æ—Ä–∏—è *",-1)),c(t("select",{"onUpdate:modelValue":e[2]||(e[2]=r=>o.form.category_id=r),required:"",class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},[e[18]||(e[18]=t("option",{value:""},"–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é",-1)),(s(!0),d(B,null,T(o.categories,r=>(s(),d("option",{key:r.id,value:r.id},m(r.name),9,yt))),128))],512),[[J,o.form.category_id,void 0,{number:!0}]])]),t("div",null,[e[20]||(e[20]=t("label",{class:"block text-sm font-medium mb-2"},"–û–ø–∏—Å–∞–Ω–∏–µ",-1)),c(t("textarea",{"onUpdate:modelValue":e[3]||(e[3]=r=>o.form.description=r),rows:"4",placeholder:"–û–ø–∏—Å–∞–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–∞...",class:"w-full px-3 py-2 border border-border rounded-lg bg-background resize-none"},null,512),[[p,o.form.description]])]),t("div",null,[e[22]||(e[22]=t("label",{class:"block text-sm font-medium mb-2"},"–¢–∏–ø —Ñ–∞–π–ª–∞ *",-1)),c(t("select",{"onUpdate:modelValue":e[4]||(e[4]=r=>o.form.file_type=r),required:"",onChange:e[5]||(e[5]=(...r)=>o.handleFileTypeChange&&o.handleFileTypeChange(...r)),class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},[...e[21]||(e[21]=[t("option",{value:"file"},"–§–∞–π–ª (–∑–∞–≥—Ä—É–∑–∫–∞ –∏–ª–∏ –∏–∑ –º–µ–¥–∏–∞-–±–∏–±–ª–∏–æ—Ç–µ–∫–∏)",-1),t("option",{value:"url"},"–í–Ω–µ—à–Ω—è—è —Å—Å—ã–ª–∫–∞",-1),t("option",{value:"telegram_file_id"},"Telegram file_id",-1)])],544),[[J,o.form.file_type]])]),o.form.file_type==="file"?(s(),d("div",kt,[e[26]||(e[26]=t("label",{class:"block text-sm font-medium mb-2"},"–§–∞–π–ª",-1)),t("div",wt,[t("div",null,[e[23]||(e[23]=t("label",{class:"block text-xs text-muted-foreground mb-2"}," –ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤—ã–π —Ñ–∞–π–ª ",-1)),t("input",{ref:"fileInput",type:"file",onChange:e[6]||(e[6]=(...r)=>o.handleFileSelect&&o.handleFileSelect(...r)),class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},null,544),o.selectedFile?(s(),d("p",ht," –í—ã–±—Ä–∞–Ω: "+m(o.selectedFile.name),1)):f("",!0)]),e[25]||(e[25]=t("div",{class:"text-center text-sm text-muted-foreground"},"–∏–ª–∏",-1)),t("div",null,[e[24]||(e[24]=t("label",{class:"block text-xs text-muted-foreground mb-2"}," –í—ã–±—Ä–∞—Ç—å –∏–∑ –º–µ–¥–∏–∞-–±–∏–±–ª–∏–æ—Ç–µ–∫–∏ ",-1)),t("button",{type:"button",onClick:e[7]||(e[7]=r=>o.showMediaPicker=!0),class:"w-full h-10 px-4 border border-border rounded-lg bg-background hover:bg-muted/10"},m(o.form.media_id?"–§–∞–π–ª –≤—ã–±—Ä–∞–Ω":"–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª"),1),o.selectedMedia?(s(),d("p",Ct," –í—ã–±—Ä–∞–Ω: "+m(o.selectedMedia.name),1)):f("",!0)])])])):f("",!0),o.form.file_type==="url"?(s(),d("div",Mt,[e[27]||(e[27]=t("label",{class:"block text-sm font-medium mb-2"},"URL *",-1)),c(t("input",{"onUpdate:modelValue":e[8]||(e[8]=r=>o.form.file_url=r),type:"url",required:"",placeholder:"https://example.com/file.pdf",class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},null,512),[[p,o.form.file_url]])])):f("",!0),o.form.file_type==="telegram_file_id"?(s(),d("div",St,[e[28]||(e[28]=t("label",{class:"block text-sm font-medium mb-2"},"Telegram file_id *",-1)),c(t("input",{"onUpdate:modelValue":e[9]||(e[9]=r=>o.form.file_id=r),type:"text",required:"",placeholder:"BQACAgIAAxkBAAI...",class:"w-full h-10 px-3 border border-border rounded-lg bg-background font-mono text-sm"},null,512),[[p,o.form.file_id]]),e[29]||(e[29]=t("p",{class:"text-xs text-muted-foreground mt-1"}," –ü–æ–ª—É—á–∏—Ç—å file_id –º–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏–≤ —Ñ–∞–π–ª –±–æ—Ç—É –∏ –ø—Ä–æ–≤–µ—Ä–∏–≤ –æ—Ç–≤–µ—Ç API ",-1))])):f("",!0),t("div",null,[e[30]||(e[30]=t("label",{class:"block text-sm font-medium mb-2"},"–ü–æ—Ä—è–¥–æ–∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è",-1)),c(t("input",{"onUpdate:modelValue":e[10]||(e[10]=r=>o.form.order_index=r),type:"number",min:"0",placeholder:"0",class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},null,512),[[p,o.form.order_index,void 0,{number:!0}]])]),t("div",null,[t("label",Dt,[c(t("input",{"onUpdate:modelValue":e[11]||(e[11]=r=>o.form.is_active=r),type:"checkbox",class:"w-4 h-4"},null,512),[[re,o.form.is_active]]),e[31]||(e[31]=t("span",null,"–ú–∞—Ç–µ—Ä–∏–∞–ª –∞–∫—Ç–∏–≤–µ–Ω",-1))])]),t("div",Ft,[t("button",{type:"button",onClick:e[12]||(e[12]=r=>n.$emit("close")),class:"flex-1 h-10 px-4 border border-border bg-background/50 hover:bg-accent/10 rounded-lg"}," –û—Ç–º–µ–Ω–∞ "),t("button",{type:"submit",disabled:o.saving,class:"flex-1 h-10 px-4 bg-accent/10 backdrop-blur-xl text-accent border border-accent/40 hover:bg-accent/20 rounded-lg disabled:opacity-50"},m(o.saving?"–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...":"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"),9,Ut)])],32),o.showMediaPicker?(s(),d("div",Vt,[t("div",Bt,[t("div",Tt,[t("div",It,[e[32]||(e[32]=t("h3",{class:"text-lg font-semibold"},"–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –∏–∑ –º–µ–¥–∏–∞-–±–∏–±–ª–∏–æ—Ç–µ–∫–∏",-1)),t("button",{onClick:e[14]||(e[14]=r=>o.showMediaPicker=!1),class:"text-muted-foreground hover:text-foreground"}," ‚úï ")]),c(t("input",{"onUpdate:modelValue":e[15]||(e[15]=r=>o.mediaSearch=r),type:"text",placeholder:"–ü–æ–∏—Å–∫ —Ñ–∞–π–ª–∞...",class:"w-full mt-4 h-10 px-3 border border-border rounded-lg bg-background"},null,512),[[p,o.mediaSearch]])]),t("div",jt,[o.loadingMedia?(s(),d("div",Et,[...e[33]||(e[33]=[t("p",{class:"text-muted-foreground"},"–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤...",-1)])])):o.mediaFiles.length===0?(s(),d("div",qt," –§–∞–π–ª—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã ")):(s(),d("div",Pt,[(s(!0),d(B,null,T(o.mediaFiles,r=>(s(),d("div",{key:r.id,onClick:l=>o.selectMedia(r),class:L(["p-4 border rounded-lg cursor-pointer transition-colors",o.form.media_id===r.id?"border-accent bg-accent/10":"border-border hover:bg-muted/10"])},[t("div",At,m(r.name),1),t("div",Nt,m(o.formatFileSize(r.size)),1)],10,zt))),128))]))]),t("div",Lt,[t("button",{onClick:e[16]||(e[16]=(...r)=>o.confirmMediaSelection&&o.confirmMediaSelection(...r)),disabled:!o.form.media_id,class:"w-full h-10 px-4 bg-accent/10 backdrop-blur-xl text-accent border border-accent/40 hover:bg-accent/20 rounded-lg disabled:opacity-50"}," –í—ã–±—Ä–∞—Ç—å ",8,Ot)])])])):f("",!0)])])}const Gt=E(gt,[["render",Rt]]),Ht={name:"CategoryForm",components:{Media:ne},props:{botId:{type:[String,Number],required:!0},category:{type:Object,default:null}},emits:["close","saved"],setup(n,{emit:e}){const i=b(!1),o=b(!1),v=b(null),k=b(!!n.category),r=b({name:"",icon:"",description:"",order_index:0,media_id:null,is_active:!0});return n.category&&(r.value={name:n.category.name||"",icon:n.category.icon||"",description:n.category.description||"",order_index:n.category.order_index||0,media_id:n.category.media_id||null,is_active:n.category.is_active!==void 0?n.category.is_active:!0},n.category.media&&(v.value=n.category.media)),{saving:i,showMediaPicker:o,selectedMedia:v,isEditMode:k,form:r,handleFileSelected:u=>{u&&(r.value.media_id=u.id,v.value=u,o.value=!1)},removeMedia:()=>{r.value.media_id=null,v.value=null},formatFileSize:u=>{if(!u)return"0 B";const a=1024,M=["B","KB","MB","GB"],C=Math.floor(Math.log(u)/Math.log(a));return Math.round(u/Math.pow(a,C)*100)/100+" "+M[C]},saveCategory:async()=>{i.value=!0;try{const u={name:r.value.name,icon:r.value.icon||null,description:r.value.description||null,order_index:r.value.order_index||0,media_id:r.value.media_id||null,is_active:r.value.is_active};let a;if(k.value?a=await O(`/bot-management/${n.botId}/materials/categories/${n.category.id}`,u):a=await W(`/bot-management/${n.botId}/materials/categories`,u),!a.ok){const M=await a.json().catch(()=>({}));throw new Error(M.message||"–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏")}await S.fire({title:"–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ",icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"}),e("saved"),e("close")}catch(u){S.fire({title:"–û—à–∏–±–∫–∞",text:u.message||"–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏",icon:"error",confirmButtonText:"–û–ö"})}finally{i.value=!1}}}}},Kt={class:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4"},Qt={class:"bg-background border border-border rounded-lg shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto"},Jt={class:"sticky top-0 bg-background border-b border-border p-6"},Wt={class:"flex items-center justify-between"},Xt={class:"text-lg font-semibold"},Yt={key:0,class:"mb-3 p-3 bg-muted/30 rounded-lg"},Zt={class:"flex items-center justify-between"},$t={class:"text-sm font-medium"},eo={class:"text-xs text-muted-foreground"},to={class:"flex items-center gap-2"},oo={class:"flex gap-4 pt-4 border-t border-border"},ro=["disabled"],lo={key:0,class:"fixed inset-0 z-[60] flex items-center justify-center bg-black/90 p-4"},so={class:"bg-background border border-border rounded-lg shadow-2xl w-full max-w-6xl max-h-[90vh] flex flex-col"},no={class:"p-6 border-b border-border flex-shrink-0"},ao={class:"flex items-center justify-between"},io={class:"flex-1 overflow-y-auto min-h-0"};function uo(n,e,i,o,v,k){const r=V("Media");return s(),d("div",Kt,[t("div",Qt,[t("div",Jt,[t("div",Wt,[t("h3",Xt,m(o.isEditMode?"–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é":"–°–æ–∑–¥–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é"),1),t("button",{onClick:e[0]||(e[0]=l=>n.$emit("close")),class:"text-muted-foreground hover:text-foreground"}," ‚úï ")])]),t("form",{onSubmit:e[9]||(e[9]=G((...l)=>o.saveCategory&&o.saveCategory(...l),["prevent"])),class:"p-6 space-y-6"},[t("div",null,[e[11]||(e[11]=t("label",{class:"block text-sm font-medium mb-2"},"–ò–∫–æ–Ω–∫–∞ (—ç–º–æ–¥–∑–∏)",-1)),c(t("input",{"onUpdate:modelValue":e[1]||(e[1]=l=>o.form.icon=l),type:"text",placeholder:"üß©",maxlength:"10",class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},null,512),[[p,o.form.icon]]),e[12]||(e[12]=t("p",{class:"text-xs text-muted-foreground mt-1"}," –≠–º–æ–¥–∑–∏ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –±–æ—Ç–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä: üß©, üìö, üìÑ) ",-1))]),t("div",null,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium mb-2"},"–ù–∞–∑–≤–∞–Ω–∏–µ *",-1)),c(t("input",{"onUpdate:modelValue":e[2]||(e[2]=l=>o.form.name=l),type:"text",required:"",placeholder:"–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏",class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},null,512),[[p,o.form.name]])]),t("div",null,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium mb-2"},"–û–ø–∏—Å–∞–Ω–∏–µ",-1)),c(t("textarea",{"onUpdate:modelValue":e[3]||(e[3]=l=>o.form.description=l),rows:"4",placeholder:"–û–ø–∏—Å–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏...",class:"w-full px-3 py-2 border border-border rounded-lg bg-background resize-none"},null,512),[[p,o.form.description]])]),t("div",null,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium mb-2"},"–ü–æ—Ä—è–¥–æ–∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è",-1)),c(t("input",{"onUpdate:modelValue":e[4]||(e[4]=l=>o.form.order_index=l),type:"number",min:"0",placeholder:"0",class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},null,512),[[p,o.form.order_index,void 0,{number:!0}]]),e[16]||(e[16]=t("p",{class:"text-xs text-muted-foreground mt-1"}," –ß–µ–º –º–µ–Ω—å—à–µ —á–∏—Å–ª–æ, —Ç–µ–º –≤—ã—à–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è –≤ —Å–ø–∏—Å–∫–µ ",-1))]),t("div",null,[e[17]||(e[17]=t("label",{class:"block text-sm font-medium mb-2"},"–§–∞–π–ª –∫–∞—Ç–µ–≥–æ—Ä–∏–∏",-1)),o.form.media_id&&o.selectedMedia?(s(),d("div",Yt,[t("div",Zt,[t("div",null,[t("p",$t,m(o.selectedMedia.name),1),t("p",eo,m(o.formatFileSize(o.selectedMedia.size)),1)]),t("button",{type:"button",onClick:e[5]||(e[5]=(...l)=>o.removeMedia&&o.removeMedia(...l)),class:"px-3 py-1 text-xs bg-red-500 hover:bg-red-600 text-white rounded"}," –£–¥–∞–ª–∏—Ç—å ")])])):f("",!0),t("button",{type:"button",onClick:e[6]||(e[6]=l=>o.showMediaPicker=!0),class:"w-full h-10 px-4 border border-border rounded-lg bg-background hover:bg-muted/10"},m(o.form.media_id?"–ò–∑–º–µ–Ω–∏—Ç—å —Ñ–∞–π–ª":"–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª –∏–∑ –º–µ–¥–∏–∞-–±–∏–±–ª–∏–æ—Ç–µ–∫–∏"),1)]),t("div",null,[t("label",to,[c(t("input",{"onUpdate:modelValue":e[7]||(e[7]=l=>o.form.is_active=l),type:"checkbox",class:"w-4 h-4"},null,512),[[re,o.form.is_active]]),e[18]||(e[18]=t("span",null,"–ö–∞—Ç–µ–≥–æ—Ä–∏—è –∞–∫—Ç–∏–≤–Ω–∞",-1))])]),t("div",oo,[t("button",{type:"button",onClick:e[8]||(e[8]=l=>n.$emit("close")),class:"flex-1 h-10 px-4 border border-border bg-background/50 hover:bg-accent/10 rounded-lg"}," –û—Ç–º–µ–Ω–∞ "),t("button",{type:"submit",disabled:o.saving,class:"flex-1 h-10 px-4 bg-accent/10 backdrop-blur-xl text-accent border border-accent/40 hover:bg-accent/20 rounded-lg disabled:opacity-50"},m(o.saving?"–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...":"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"),9,ro)])],32),o.showMediaPicker?(s(),d("div",lo,[t("div",so,[t("div",no,[t("div",ao,[e[19]||(e[19]=t("h3",{class:"text-lg font-semibold"},"–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –∏–∑ –º–µ–¥–∏–∞-–±–∏–±–ª–∏–æ—Ç–µ–∫–∏",-1)),t("button",{onClick:e[10]||(e[10]=l=>o.showMediaPicker=!1),class:"text-muted-foreground hover:text-foreground"}," ‚úï ")])]),t("div",io,[N(r,{"selection-mode":!0,"count-file":1,"selected-files":o.form.media_id?[{id:o.form.media_id}]:[],onFileSelected:o.handleFileSelected},null,8,["selected-files","onFileSelected"])])])])):f("",!0)])])}const mo=E(Ht,[["render",uo]]),bo={name:"MaterialCategoryTree",components:{MaterialForm:Gt,CategoryForm:mo,Media:ne},props:{botId:{type:[String,Number],required:!0}},setup(n){const e=b(!1),i=b([]),o=b(!1),v=b(!1),k=b(null),r=b(null),l=b(null),y=b(null),x=b(null),w=b(null),u=b(null),a=async()=>{e.value=!0;try{const g=await j(`/bot-management/${n.botId}/materials/categories`);if(!g.ok)throw new Error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π");const h=await g.json();i.value=h.data||[];for(const F of i.value)await C(F)}catch(g){console.error("Error fetching categories:",g)}finally{e.value=!1}},M=()=>{r.value=null,o.value=!0},C=async g=>{try{const h=await j(`/bot-management/${n.botId}/materials`,{category_id:g.id});if(h.ok){const F=await h.json();g.materials=F.data||[]}}catch(h){console.error("Error fetching materials:",h)}},I=async g=>{if((await S.fire({title:"–£–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é?",text:`–ö–∞—Ç–µ–≥–æ—Ä–∏—è "${g.name}" –∏ –≤—Å–µ –µ—ë –º–∞—Ç–µ—Ä–∏–∞–ª—ã –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.`,icon:"warning",showCancelButton:!0,confirmButtonText:"–£–¥–∞–ª–∏—Ç—å",cancelButtonText:"–û—Ç–º–µ–Ω–∞"})).isConfirmed)try{if(!(await se(`/bot-management/${n.botId}/materials/categories/${g.id}`)).ok)throw new Error("–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏");await S.fire({title:"–£–¥–∞–ª–µ–Ω–æ",icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"}),a()}catch(F){S.fire({title:"–û—à–∏–±–∫–∞",text:F.message||"–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏",icon:"error"})}},q=async g=>{if((await S.fire({title:"–£–¥–∞–ª–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª?",text:`–ú–∞—Ç–µ—Ä–∏–∞–ª "${g.title}" –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω.`,icon:"warning",showCancelButton:!0,confirmButtonText:"–£–¥–∞–ª–∏—Ç—å",cancelButtonText:"–û—Ç–º–µ–Ω–∞"})).isConfirmed)try{if(!(await se(`/bot-management/${n.botId}/materials/${g.id}`)).ok)throw new Error("–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–∞");await S.fire({title:"–£–¥–∞–ª–µ–Ω–æ",icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"}),a()}catch(F){S.fire({title:"–û—à–∏–±–∫–∞",text:F.message||"–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–∞",icon:"error"})}},X=g=>{r.value=g,o.value=!0},Y=()=>{o.value=!1,r.value=null},Z=()=>{a()},$=g=>{l.value=g,v.value=!0},_=g=>{k.value=g,l.value=null,v.value=!0},D=b(!1),U=b(null),H=async g=>{U.value=g,D.value=!0},de=async g=>{if(!(!U.value||!g))try{if(!(await O(`/bot-management/${n.botId}/materials/categories/${U.value.id}`,{media_id:g.id})).ok)throw new Error("–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏");D.value=!1,U.value=null,await S.fire({title:"–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ",icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"}),a()}catch(h){S.fire({title:"–û—à–∏–±–∫–∞",text:h.message||"–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–∞",icon:"error"})}},ae=async g=>{try{if(!(await O(`/bot-management/${n.botId}/materials/categories/${g.id}`,{media_id:null})).ok)throw new Error("–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ñ–∞–π–ª–∞");await S.fire({title:"–§–∞–π–ª —É–¥–∞–ª–µ–Ω",icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"}),a()}catch(h){S.fire({title:"–û—à–∏–±–∫–∞",text:h.message||"–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ñ–∞–π–ª–∞",icon:"error"})}},ie=()=>{v.value=!1,l.value=null,k.value=null},ue=()=>{a()},me=(g,h)=>{y.value=h,g.dataTransfer.effectAllowed="move",g.dataTransfer.setData("text/html",g.target.outerHTML)},be=(g,h)=>{g.preventDefault(),y.value!==null&&y.value!==h&&(g.dataTransfer.dropEffect="move")},ce=async(g,h)=>{if(g.preventDefault(),y.value===null||y.value===h)return;const F=y.value,P=[...i.value],[K]=P.splice(F,1);P.splice(h,0,K);const z=P.map((A,ee)=>({id:A.id,order_index:ee}));try{(await W(`/bot-management/${n.botId}/materials/categories/update-positions`,{categories:z})).ok&&(i.value=P,await S.fire({title:"–ü–æ–∑–∏—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞",icon:"success",timer:1500,showConfirmButton:!1,toast:!0,position:"top-end"}))}catch(A){console.error("Error updating category positions:",A),S.fire({title:"–û—à–∏–±–∫–∞",text:"–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –ø–æ–∑–∏—Ü–∏—é –∫–∞—Ç–µ–≥–æ—Ä–∏–∏",icon:"error"}),a()}},ge=()=>{y.value=null},fe=(g,h,F)=>{x.value=F,w.value=h,g.dataTransfer.effectAllowed="move",g.dataTransfer.setData("text/html",g.target.outerHTML)},xe=(g,h,F)=>{g.preventDefault(),x.value!==null&&w.value===h&&x.value!==F&&(g.dataTransfer.dropEffect="move")},ve=async(g,h,F)=>{if(g.preventDefault(),x.value===null||w.value!==h||x.value===F)return;const P=x.value,K=i.value[h],z=[...K.materials],[A]=z.splice(P,1);z.splice(F,0,A);const ee=z.map((Q,_e)=>({id:Q.id,order_index:_e}));try{(await W(`/bot-management/${n.botId}/materials/update-positions`,{materials:ee})).ok&&(K.materials=z,await S.fire({title:"–ü–æ–∑–∏—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞",icon:"success",timer:1500,showConfirmButton:!1,toast:!0,position:"top-end"}))}catch(Q){console.error("Error updating material positions:",Q),S.fire({title:"–û—à–∏–±–∫–∞",text:"–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –ø–æ–∑–∏—Ü–∏—é –º–∞—Ç–µ—Ä–∏–∞–ª–∞",icon:"error"}),a()}},pe=()=>{x.value=null,w.value=null};return R(()=>{a()}),{loading:e,categories:i,showCategoryForm:o,showMaterialForm:v,selectedCategory:k,selectedCategoryForEdit:r,selectedMaterial:l,draggedCategoryIndex:y,draggedMaterialIndex:x,categoriesContainer:u,fetchCategories:a,createCategory:M,deleteCategory:I,deleteMaterial:q,editCategory:X,editMaterial:$,showMaterialModal:_,selectCategoryFile:H,showMediaPicker:D,selectedCategoryForFile:U,handleFileSelected:de,removeCategoryFile:ae,handleMaterialFormClose:ie,handleMaterialSaved:ue,handleCategoryFormClose:Y,handleCategorySaved:Z,handleCategoryDragStart:me,handleCategoryDragOver:be,handleCategoryDrop:ce,handleCategoryDragEnd:ge,handleMaterialDragStart:fe,handleMaterialDragOver:xe,handleMaterialDrop:ve,handleMaterialDragEnd:pe}}},co={class:"material-category-tree space-y-4"},go={class:"flex items-center justify-between"},fo={key:0,class:"text-center py-12"},xo={key:1,class:"space-y-4",ref:"categoriesContainer"},vo=["onDragstart","onDragover","onDrop"],po={class:"flex items-center justify-between mb-4"},_o={class:"text-lg font-semibold"},yo={key:0},ko={key:0,class:"text-sm text-muted-foreground mt-1"},wo={key:1,class:"text-xs text-muted-foreground mt-1"},ho={class:"flex gap-2"},Co=["onClick"],Mo=["onClick"],So=["onClick"],Do=["onClick"],Fo={key:0,class:"space-y-2"},Uo=["onDragstart","onDragover","onDrop"],Vo={class:"font-medium"},Bo={key:0,class:"text-sm text-muted-foreground"},To={class:"text-xs text-muted-foreground"},Io={class:"flex gap-2"},jo=["onClick"],Eo=["onClick"],qo={key:1,class:"text-sm text-muted-foreground p-3"},Po=["onClick"],zo={key:0,class:"text-center py-12 text-muted-foreground"},Ao={key:4,class:"fixed inset-0 z-[60] flex items-center justify-center bg-black/90 p-4"},No={class:"bg-background border border-border rounded-lg shadow-2xl w-full max-w-6xl max-h-[90vh] flex flex-col"},Lo={class:"p-6 border-b border-border flex-shrink-0"},Oo={class:"flex items-center justify-between"},Ro={class:"flex-1 overflow-y-auto min-h-0"};function Go(n,e,i,o,v,k){const r=V("MaterialForm"),l=V("CategoryForm"),y=V("Media");return s(),d("div",co,[t("div",go,[e[4]||(e[4]=t("h2",{class:"text-2xl font-semibold"},"–ú–∞—Ç–µ—Ä–∏–∞–ª—ã",-1)),t("button",{onClick:e[0]||(e[0]=(...x)=>o.createCategory&&o.createCategory(...x)),class:"h-11 px-6 bg-accent/10 backdrop-blur-xl text-accent border border-accent/40 hover:bg-accent/20 rounded-2xl"}," + –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é ")]),o.loading?(s(),d("div",fo,[...e[5]||(e[5]=[t("p",{class:"text-muted-foreground"},"–ó–∞–≥—Ä—É–∑–∫–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤...",-1)])])):f("",!0),o.loading?f("",!0):(s(),d("div",xo,[(s(!0),d(B,null,T(o.categories,(x,w)=>(s(),d("div",{key:x.id,draggable:!0,onDragstart:u=>o.handleCategoryDragStart(u,w),onDragover:G(u=>o.handleCategoryDragOver(u,w),["prevent"]),onDrop:u=>o.handleCategoryDrop(u,w),onDragend:e[2]||(e[2]=(...u)=>o.handleCategoryDragEnd&&o.handleCategoryDragEnd(...u)),class:L(["bg-card rounded-lg border border-border p-4 cursor-move transition-all",o.draggedCategoryIndex===w?"opacity-50 border-accent":""])},[t("div",po,[t("div",null,[t("h3",_o,[x.icon?(s(),d("span",yo,m(x.icon),1)):f("",!0),le(m(x.name),1)]),x.description?(s(),d("p",ko,m(x.description),1)):f("",!0),x.media?(s(),d("p",wo," üìé –§–∞–π–ª: "+m(x.media.name),1)):f("",!0)]),t("div",ho,[t("button",{onClick:u=>o.editCategory(x),class:"px-3 py-1 text-xs bg-green-500 hover:bg-green-600 text-white rounded"}," ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å ",8,Co),x.media_id?(s(),d("button",{key:1,onClick:u=>o.removeCategoryFile(x),class:"px-3 py-1 text-xs bg-orange-500 hover:bg-orange-600 text-white rounded"}," üóëÔ∏è –£–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª ",8,So)):(s(),d("button",{key:0,onClick:u=>o.selectCategoryFile(x),class:"px-3 py-1 text-xs bg-blue-500 hover:bg-blue-600 text-white rounded"}," üìé –§–∞–π–ª ",8,Mo)),t("button",{onClick:u=>o.deleteCategory(x),class:"px-3 py-1 text-xs bg-red-500 hover:bg-red-600 text-white rounded"}," –£–¥–∞–ª–∏—Ç—å ",8,Do)])]),x.materials&&x.materials.length>0?(s(),d("div",Fo,[(s(!0),d(B,null,T(x.materials,(u,a)=>(s(),d("div",{key:u.id,draggable:!0,onDragstart:M=>o.handleMaterialDragStart(M,w,a),onDragover:G(M=>o.handleMaterialDragOver(M,w,a),["prevent"]),onDrop:M=>o.handleMaterialDrop(M,w,a),onDragend:e[1]||(e[1]=(...M)=>o.handleMaterialDragEnd&&o.handleMaterialDragEnd(...M)),class:L(["flex items-center justify-between p-3 bg-muted/30 rounded-lg cursor-move transition-all",o.draggedMaterialIndex===a&&o.draggedCategoryIndex===w?"opacity-50 border-2 border-accent":""])},[t("div",null,[t("p",Vo,m(u.title),1),u.description?(s(),d("p",Bo,m(u.description),1)):f("",!0),t("p",To," –°–∫–∞—á–∏–≤–∞–Ω–∏–π: "+m(u.download_count||0),1)]),t("div",Io,[t("button",{onClick:M=>o.editMaterial(u),class:"px-3 py-1 text-xs bg-blue-500 hover:bg-blue-600 text-white rounded"}," –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å ",8,jo),t("button",{onClick:M=>o.deleteMaterial(u),class:"px-3 py-1 text-xs bg-red-500 hover:bg-red-600 text-white rounded"}," –£–¥–∞–ª–∏—Ç—å ",8,Eo)])],42,Uo))),128))])):(s(),d("div",qo,[e[6]||(e[6]=le(" –ù–µ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ ",-1)),t("button",{onClick:u=>o.showMaterialModal(x),class:"ml-2 px-3 py-1 text-xs bg-accent/10 text-accent border border-accent/40 hover:bg-accent/20 rounded"}," + –î–æ–±–∞–≤–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª ",8,Po)]))],42,vo))),128)),o.categories.length===0?(s(),d("div",zo," –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é. ")):f("",!0)],512)),o.showMaterialForm?(s(),oe(r,{key:2,"bot-id":i.botId,"category-id":o.selectedCategory?.id||o.selectedMaterial?.category_id,material:o.selectedMaterial,onClose:o.handleMaterialFormClose,onSaved:o.handleMaterialSaved},null,8,["bot-id","category-id","material","onClose","onSaved"])):f("",!0),o.showCategoryForm?(s(),oe(l,{key:3,"bot-id":i.botId,category:o.selectedCategoryForEdit,onClose:o.handleCategoryFormClose,onSaved:o.handleCategorySaved},null,8,["bot-id","category","onClose","onSaved"])):f("",!0),o.showMediaPicker?(s(),d("div",Ao,[t("div",No,[t("div",Lo,[t("div",Oo,[e[7]||(e[7]=t("h3",{class:"text-lg font-semibold"},"–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –∏–∑ –º–µ–¥–∏–∞-–±–∏–±–ª–∏–æ—Ç–µ–∫–∏",-1)),t("button",{onClick:e[3]||(e[3]=x=>{o.showMediaPicker=!1,o.selectedCategoryForFile=null}),class:"text-muted-foreground hover:text-foreground"}," ‚úï ")])]),t("div",Ro,[N(y,{"selection-mode":!0,"count-file":1,"selected-files":o.selectedCategoryForFile?.media_id?[{id:o.selectedCategoryForFile.media_id}]:[],onFileSelected:o.handleFileSelected},null,8,["selected-files","onFileSelected"])])])])):f("",!0)])}const Ho=E(bo,[["render",Go]]),Ko={name:"BotSettingsForm",props:{botId:{type:[String,Number],required:!0}},emits:["updated"],setup(n,{emit:e}){const i=b(!1),o=b(!1),v=b("main"),k=[{key:"main",label:"–û—Å–Ω–æ–≤–Ω—ã–µ"},{key:"messages",label:"–°–æ–æ–±—â–µ–Ω–∏—è"},{key:"advanced",label:"–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ"}],r=b({required_channel_id:null,required_channel_username:"",admin_telegram_ids:[],yandex_maps_url:"",welcome_message:"",other_settings:{phone_validation_strict:!1,max_description_length:1e3,subscription_check_timeout:5}}),l=async()=>{i.value=!0;try{const u=await j(`/bot-management/${n.botId}/settings`);if(!u.ok)throw new Error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫");const a=await u.json();if(a.success&&a.data){const M=a.data.settings||{},C=M.messages||{};r.value={required_channel_id:a.data.required_channel_id||null,required_channel_username:a.data.required_channel_username||"",admin_telegram_ids:a.data.admin_telegram_ids||[],yandex_maps_url:a.data.yandex_maps_url||"",welcome_message:a.data.welcome_message||"",messages:{subscription:C.subscription||{required_text:"",subscribe_button:"",check_button:""},consultation:C.consultation||{description:"",form_name_label:"",form_phone_label:"",form_description_label:"",thank_you:"",start_button:"",skip_description_button:""},materials:C.materials||{list_description:"",download_button:"",back_to_list:""},menu:C.menu||{materials_button:"",consultation_button:"",review_button:"",back_to_menu:""},notifications:C.notifications||{consultation_template:""}},other_settings:M.other_settings||{phone_validation_strict:!1,max_description_length:1e3,subscription_check_timeout:5}}}}catch(u){console.error("Error fetching settings:",u)}finally{i.value=!1}},y=async()=>{o.value=!0;try{const u=await O(`/bot-management/${n.botId}/settings`,{required_channel_id:r.value.required_channel_id,required_channel_username:r.value.required_channel_username,admin_telegram_ids:r.value.admin_telegram_ids,yandex_maps_url:r.value.yandex_maps_url,welcome_message:r.value.welcome_message,settings:{messages:r.value.messages,other_settings:r.value.other_settings}});if(!u.ok){const a=await u.json().catch(()=>({}));throw new Error(a.message||"–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫")}await S.fire({title:"–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ",icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"}),e("updated")}catch(u){S.fire({title:"–û—à–∏–±–∫–∞",text:u.message||"–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫",icon:"error",confirmButtonText:"–û–ö"})}finally{o.value=!1}},x=()=>{r.value.admin_telegram_ids.push(null)},w=u=>{r.value.admin_telegram_ids.splice(u,1)};return R(()=>{l()}),{loading:i,saving:o,activeTab:v,tabs:k,form:r,fetchSettings:l,saveSettings:y,addAdmin:x,removeAdmin:w}}},Qo={class:"bot-settings-form space-y-6"},Jo={class:"border-b border-border"},Wo={class:"flex -mb-px"},Xo=["onClick"],Yo={key:0,class:"bg-card rounded-lg border border-border p-6 space-y-4"},Zo={class:"space-y-2"},$o=["onUpdate:modelValue"],er=["onClick"],tr={key:1,class:"bg-card rounded-lg border border-border p-6 space-y-6"},or={class:"space-y-4"},rr={class:"space-y-4 pt-4 border-t border-border"},lr={class:"space-y-4 pt-4 border-t border-border"},sr={class:"space-y-4 pt-4 border-t border-border"},nr={class:"space-y-4 pt-4 border-t border-border"},dr={key:2,class:"bg-card rounded-lg border border-border p-6 space-y-4"},ar={class:"flex items-center gap-2"},ir={class:"flex gap-4"},ur=["disabled"];function mr(n,e,i,o,v,k){return s(),d("div",Qo,[e[64]||(e[64]=t("h2",{class:"text-2xl font-semibold"},"–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞",-1)),t("div",Jo,[t("nav",Wo,[(s(!0),d(B,null,T(o.tabs,r=>(s(),d("button",{key:r.key,onClick:l=>o.activeTab=r.key,class:L(["px-6 py-4 text-sm font-medium border-b-2 transition-colors",o.activeTab===r.key?"border-accent text-accent":"border-transparent text-muted-foreground hover:text-foreground hover:border-muted-foreground"])},m(r.label),11,Xo))),128))])]),t("form",{onSubmit:e[26]||(e[26]=G((...r)=>o.saveSettings&&o.saveSettings(...r),["prevent"])),class:"space-y-6"},[o.activeTab==="main"?(s(),d("div",Yo,[e[34]||(e[34]=t("h3",{class:"text-lg font-semibold"},"–û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏",-1)),t("div",null,[e[27]||(e[27]=t("label",{class:"block text-sm font-medium mb-2"},"ID –∫–∞–Ω–∞–ª–∞",-1)),c(t("input",{"onUpdate:modelValue":e[0]||(e[0]=r=>o.form.required_channel_id=r),type:"number",placeholder:"-1001234567890",class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},null,512),[[p,o.form.required_channel_id,void 0,{number:!0}]]),e[28]||(e[28]=t("p",{class:"text-xs text-muted-foreground mt-1"}," ID –∫–∞–Ω–∞–ª–∞ (–º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —á–µ—Ä–µ–∑ –±–æ—Ç–∞ @userinfobot) ",-1))]),t("div",null,[e[29]||(e[29]=t("label",{class:"block text-sm font-medium mb-2"},"Username –∫–∞–Ω–∞–ª–∞",-1)),c(t("input",{"onUpdate:modelValue":e[1]||(e[1]=r=>o.form.required_channel_username=r),type:"text",placeholder:"aip_channel",class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},null,512),[[p,o.form.required_channel_username]]),e[30]||(e[30]=t("p",{class:"text-xs text-muted-foreground mt-1"}," Username –∫–∞–Ω–∞–ª–∞ –±–µ–∑ —Å–∏–º–≤–æ–ª–∞ @ ",-1))]),t("div",null,[e[31]||(e[31]=t("label",{class:"block text-sm font-medium mb-2"},"Telegram ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤",-1)),t("div",Zo,[(s(!0),d(B,null,T(o.form.admin_telegram_ids,(r,l)=>(s(),d("div",{key:l,class:"flex gap-2"},[c(t("input",{"onUpdate:modelValue":y=>o.form.admin_telegram_ids[l]=y,type:"number",placeholder:"123456789",class:"flex-1 h-10 px-3 border border-border rounded-lg bg-background"},null,8,$o),[[p,o.form.admin_telegram_ids[l],void 0,{number:!0}]]),t("button",{type:"button",onClick:y=>o.removeAdmin(l),class:"px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg"}," –£–¥–∞–ª–∏—Ç—å ",8,er)]))),128)),t("button",{type:"button",onClick:e[2]||(e[2]=(...r)=>o.addAdmin&&o.addAdmin(...r)),class:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg"}," + –î–æ–±–∞–≤–∏—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ ")])]),t("div",null,[e[32]||(e[32]=t("label",{class:"block text-sm font-medium mb-2"},"–°—Å—ã–ª–∫–∞ –Ω–∞ –Ø–Ω–¥–µ–∫—Å –ö–∞—Ä—Ç—ã",-1)),c(t("input",{"onUpdate:modelValue":e[3]||(e[3]=r=>o.form.yandex_maps_url=r),type:"url",placeholder:"https://yandex.ru/maps/org/...",class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},null,512),[[p,o.form.yandex_maps_url]])]),t("div",null,[e[33]||(e[33]=t("label",{class:"block text-sm font-medium mb-2"},"–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ",-1)),c(t("textarea",{"onUpdate:modelValue":e[4]||(e[4]=r=>o.form.welcome_message=r),rows:"6",placeholder:"–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å...",class:"w-full px-3 py-2 border border-border rounded-lg bg-background resize-none"},null,512),[[p,o.form.welcome_message]])])])):f("",!0),o.activeTab==="messages"?(s(),d("div",tr,[e[59]||(e[59]=t("h3",{class:"text-lg font-semibold"},"–¢–µ–∫—Å—Ç—ã —Å–æ–æ–±—â–µ–Ω–∏–π –±–æ—Ç–∞",-1)),t("div",or,[e[38]||(e[38]=t("h4",{class:"text-md font-medium"},"–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∫–∞–Ω–∞–ª",-1)),t("div",null,[e[35]||(e[35]=t("label",{class:"block text-sm font-medium mb-2"},"–¢–µ–∫—Å—Ç —ç–∫—Ä–∞–Ω–∞ –ø–æ–¥–ø–∏—Å–∫–∏",-1)),c(t("textarea",{"onUpdate:modelValue":e[5]||(e[5]=r=>o.form.messages.subscription.required_text=r),rows:"3",placeholder:"–î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –±–µ—Ç–∞-–≤–µ—Ä—Å–∏–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è...",class:"w-full px-3 py-2 border border-border rounded-lg bg-background resize-none"},null,512),[[p,o.form.messages.subscription.required_text]])]),t("div",null,[e[36]||(e[36]=t("label",{class:"block text-sm font-medium mb-2"},"–¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏",-1)),c(t("input",{"onUpdate:modelValue":e[6]||(e[6]=r=>o.form.messages.subscription.subscribe_button=r),type:"text",placeholder:"üîî –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ Telegram",class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},null,512),[[p,o.form.messages.subscription.subscribe_button]])]),t("div",null,[e[37]||(e[37]=t("label",{class:"block text-sm font-medium mb-2"},"–¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏",-1)),c(t("input",{"onUpdate:modelValue":e[7]||(e[7]=r=>o.form.messages.subscription.check_button=r),type:"text",placeholder:"‚úÖ –Ø –ø–æ–¥–ø–∏—Å–∞–ª—Å—è",class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},null,512),[[p,o.form.messages.subscription.check_button]])])]),t("div",rr,[e[46]||(e[46]=t("h4",{class:"text-md font-medium"},"–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è",-1)),t("div",null,[e[39]||(e[39]=t("label",{class:"block text-sm font-medium mb-2"},"–û–ø–∏—Å–∞–Ω–∏–µ —É—Å–ª—É–≥–∏",-1)),c(t("textarea",{"onUpdate:modelValue":e[8]||(e[8]=r=>o.form.messages.consultation.description=r),rows:"4",placeholder:"–ï—Å–ª–∏ –≤–∞—à–µ–º—É –±–∏–∑–Ω–µ—Å—É –Ω—É–∂–Ω–∞ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è...",class:"w-full px-3 py-2 border border-border rounded-lg bg-background resize-none"},null,512),[[p,o.form.messages.consultation.description]])]),t("div",null,[e[40]||(e[40]=t("label",{class:"block text-sm font-medium mb-2"},'–¢–µ–∫—Å—Ç –ø–æ–ª—è "–ò–º—è"',-1)),c(t("input",{"onUpdate:modelValue":e[9]||(e[9]=r=>o.form.messages.consultation.form_name_label=r),type:"text",placeholder:"–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è:",class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},null,512),[[p,o.form.messages.consultation.form_name_label]])]),t("div",null,[e[41]||(e[41]=t("label",{class:"block text-sm font-medium mb-2"},'–¢–µ–∫—Å—Ç –ø–æ–ª—è "–¢–µ–ª–µ—Ñ–æ–Ω"',-1)),c(t("input",{"onUpdate:modelValue":e[10]||(e[10]=r=>o.form.messages.consultation.form_phone_label=r),type:"text",placeholder:"–í–≤–µ–¥–∏—Ç–µ –≤–∞—à —Ç–µ–ª–µ—Ñ–æ–Ω:",class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},null,512),[[p,o.form.messages.consultation.form_phone_label]])]),t("div",null,[e[42]||(e[42]=t("label",{class:"block text-sm font-medium mb-2"},'–¢–µ–∫—Å—Ç –ø–æ–ª—è "–û–ø–∏—Å–∞–Ω–∏–µ"',-1)),c(t("input",{"onUpdate:modelValue":e[11]||(e[11]=r=>o.form.messages.consultation.form_description_label=r),type:"text",placeholder:"–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ...):",class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},null,512),[[p,o.form.messages.consultation.form_description_label]])]),t("div",null,[e[43]||(e[43]=t("label",{class:"block text-sm font-medium mb-2"},"–°–æ–æ–±—â–µ–Ω–∏–µ –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏",-1)),c(t("textarea",{"onUpdate:modelValue":e[12]||(e[12]=r=>o.form.messages.consultation.thank_you=r),rows:"2",placeholder:"–°–ø–∞—Å–∏–±–æ. –ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è.",class:"w-full px-3 py-2 border border-border rounded-lg bg-background resize-none"},null,512),[[p,o.form.messages.consultation.thank_you]])]),t("div",null,[e[44]||(e[44]=t("label",{class:"block text-sm font-medium mb-2"},'–¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ "–ó–∞–ø–∏—Å–∞—Ç—å—Å—è"',-1)),c(t("input",{"onUpdate:modelValue":e[13]||(e[13]=r=>o.form.messages.consultation.start_button=r),type:"text",placeholder:"üìù –ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é",class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},null,512),[[p,o.form.messages.consultation.start_button]])]),t("div",null,[e[45]||(e[45]=t("label",{class:"block text-sm font-medium mb-2"},'–¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ "–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å"',-1)),c(t("input",{"onUpdate:modelValue":e[14]||(e[14]=r=>o.form.messages.consultation.skip_description_button=r),type:"text",placeholder:"–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å",class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},null,512),[[p,o.form.messages.consultation.skip_description_button]])])]),t("div",lr,[e[50]||(e[50]=t("h4",{class:"text-md font-medium"},"–ú–∞—Ç–µ—Ä–∏–∞–ª—ã",-1)),t("div",null,[e[47]||(e[47]=t("label",{class:"block text-sm font-medium mb-2"},"–û–ø–∏—Å–∞–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤",-1)),c(t("textarea",{"onUpdate:modelValue":e[15]||(e[15]=r=>o.form.messages.materials.list_description=r),rows:"3",placeholder:"–ú—ã –ø–æ–¥–≥–æ—Ç–æ–≤–∏–ª–∏ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –ø–æ –∫–ª—é—á–µ–≤—ã–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º...",class:"w-full px-3 py-2 border border-border rounded-lg bg-background resize-none"},null,512),[[p,o.form.messages.materials.list_description]])]),t("div",null,[e[48]||(e[48]=t("label",{class:"block text-sm font-medium mb-2"},"–¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è",-1)),c(t("input",{"onUpdate:modelValue":e[16]||(e[16]=r=>o.form.messages.materials.download_button=r),type:"text",placeholder:"‚¨áÔ∏è –°–∫–∞—á–∞—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª—ã",class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},null,512),[[p,o.form.messages.materials.download_button]])]),t("div",null,[e[49]||(e[49]=t("label",{class:"block text-sm font-medium mb-2"},'–¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥"',-1)),c(t("input",{"onUpdate:modelValue":e[17]||(e[17]=r=>o.form.messages.materials.back_to_list=r),type:"text",placeholder:"‚¨ÖÔ∏è –ù–∞–∑–∞–¥",class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},null,512),[[p,o.form.messages.materials.back_to_list]])])]),t("div",sr,[e[55]||(e[55]=t("h4",{class:"text-md font-medium"},"–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é",-1)),t("div",null,[e[51]||(e[51]=t("label",{class:"block text-sm font-medium mb-2"},'–¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ "–ú–∞—Ç–µ—Ä–∏–∞–ª—ã"',-1)),c(t("input",{"onUpdate:modelValue":e[18]||(e[18]=r=>o.form.messages.menu.materials_button=r),type:"text",placeholder:"üìÇ –ü–æ–ª–µ–∑–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –∏ –¥–æ–≥–æ–≤–æ—Ä—ã",class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},null,512),[[p,o.form.messages.menu.materials_button]])]),t("div",null,[e[52]||(e[52]=t("label",{class:"block text-sm font-medium mb-2"},'–¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ "–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è"',-1)),c(t("input",{"onUpdate:modelValue":e[19]||(e[19]=r=>o.form.messages.menu.consultation_button=r),type:"text",placeholder:"üìû –ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é",class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},null,512),[[p,o.form.messages.menu.consultation_button]])]),t("div",null,[e[53]||(e[53]=t("label",{class:"block text-sm font-medium mb-2"},'–¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ "–û—Ç–∑—ã–≤"',-1)),c(t("input",{"onUpdate:modelValue":e[20]||(e[20]=r=>o.form.messages.menu.review_button=r),type:"text",placeholder:"‚≠ê –û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤ –Ω–∞ –Ø–Ω–¥–µ–∫—Å –ö–∞—Ä—Ç–∞—Ö",class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},null,512),[[p,o.form.messages.menu.review_button]])]),t("div",null,[e[54]||(e[54]=t("label",{class:"block text-sm font-medium mb-2"},'–¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é"',-1)),c(t("input",{"onUpdate:modelValue":e[21]||(e[21]=r=>o.form.messages.menu.back_to_menu=r),type:"text",placeholder:"‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é",class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},null,512),[[p,o.form.messages.menu.back_to_menu]])])]),t("div",nr,[e[58]||(e[58]=t("h4",{class:"text-md font-medium"},"–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º",-1)),t("div",null,[e[56]||(e[56]=t("label",{class:"block text-sm font-medium mb-2"},"–®–∞–±–ª–æ–Ω —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤–æ–π –∑–∞—è–≤–∫–µ",-1)),c(t("textarea",{"onUpdate:modelValue":e[22]||(e[22]=r=>o.form.messages.notifications.consultation_template=r),rows:"6",placeholder:`–ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞ –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é

–ò–º—è: {name}
–¢–µ–ª–µ—Ñ–æ–Ω: {phone}
–û–ø–∏—Å–∞–Ω–∏–µ: {description}
–î–∞—Ç–∞: {date}`,class:"w-full px-3 py-2 border border-border rounded-lg bg-background resize-none font-mono text-sm"},null,512),[[p,o.form.messages.notifications.consultation_template]]),e[57]||(e[57]=t("p",{class:"text-xs text-muted-foreground mt-1"}," –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ: {name}, {phone}, {description}, {date} ",-1))])])])):f("",!0),o.activeTab==="advanced"?(s(),d("div",dr,[e[63]||(e[63]=t("h3",{class:"text-lg font-semibold"},"–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏",-1)),t("div",null,[t("label",ar,[c(t("input",{"onUpdate:modelValue":e[23]||(e[23]=r=>o.form.other_settings.phone_validation_strict=r),type:"checkbox",class:"w-4 h-4"},null,512),[[re,o.form.other_settings.phone_validation_strict]]),e[60]||(e[60]=t("span",null,"–°—Ç—Ä–æ–≥–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞",-1))])]),t("div",null,[e[61]||(e[61]=t("label",{class:"block text-sm font-medium mb-2"},"–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –æ–ø–∏—Å–∞–Ω–∏—è",-1)),c(t("input",{"onUpdate:modelValue":e[24]||(e[24]=r=>o.form.other_settings.max_description_length=r),type:"number",min:"10",max:"5000",class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},null,512),[[p,o.form.other_settings.max_description_length,void 0,{number:!0}]])]),t("div",null,[e[62]||(e[62]=t("label",{class:"block text-sm font-medium mb-2"},"–¢–∞–π–º–∞—É—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏ (—Å–µ–∫)",-1)),c(t("input",{"onUpdate:modelValue":e[25]||(e[25]=r=>o.form.other_settings.subscription_check_timeout=r),type:"number",min:"1",max:"30",class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},null,512),[[p,o.form.other_settings.subscription_check_timeout,void 0,{number:!0}]])])])):f("",!0),t("div",ir,[t("button",{type:"submit",disabled:o.saving,class:"flex-1 h-11 px-6 bg-accent/10 backdrop-blur-xl text-accent border border-accent/40 hover:bg-accent/20 rounded-2xl disabled:opacity-50"},m(o.saving?"–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...":"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏"),9,ur)])],32)])}const br=E(Ko,[["render",mr]]),cr={name:"BotStatistics",props:{botId:{type:[String,Number],required:!0}},setup(n){const e=b(!1),i=b(null),o=async()=>{e.value=!0;try{const v=await j(`/bot-management/${n.botId}/statistics`);if(!v.ok)throw new Error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏");const k=await v.json();k.success&&k.data&&(i.value=k.data)}catch(v){console.error("Error fetching statistics:",v)}finally{e.value=!1}};return R(()=>{o()}),{loading:e,statistics:i}}},gr={class:"bot-statistics space-y-6"},fr={key:0,class:"text-center py-12"},xr={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},vr={class:"bg-card rounded-lg border border-border p-6"},pr={class:"text-3xl font-semibold"},_r={class:"bg-card rounded-lg border border-border p-6"},yr={class:"text-3xl font-semibold"},kr={class:"bg-card rounded-lg border border-border p-6"},wr={class:"text-3xl font-semibold"},hr={class:"bg-card rounded-lg border border-border p-6"},Cr={class:"text-3xl font-semibold"},Mr={key:2,class:"bg-card rounded-lg border border-border p-6"},Sr={class:"grid grid-cols-3 gap-4"},Dr={class:"text-2xl font-semibold"},Fr={class:"text-2xl font-semibold"},Ur={class:"text-2xl font-semibold"},Vr={key:3,class:"bg-card rounded-lg border border-border p-6"},Br={class:"space-y-2"},Tr={class:"font-medium"},Ir={class:"text-sm text-muted-foreground"};function jr(n,e,i,o,v,k){return s(),d("div",gr,[e[10]||(e[10]=t("h2",{class:"text-2xl font-semibold"},"–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞",-1)),o.loading?(s(),d("div",fr,[...e[0]||(e[0]=[t("p",{class:"text-muted-foreground"},"–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...",-1)])])):f("",!0),!o.loading&&o.statistics?(s(),d("div",xr,[t("div",vr,[e[1]||(e[1]=t("h3",{class:"text-sm font-medium text-muted-foreground mb-2"},"–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π",-1)),t("p",pr,m(o.statistics.total_users||0),1)]),t("div",_r,[e[2]||(e[2]=t("h3",{class:"text-sm font-medium text-muted-foreground mb-2"},"–ê–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞ 30 –¥–Ω–µ–π",-1)),t("p",yr,m(o.statistics.active_users_30d||0),1)]),t("div",kr,[e[3]||(e[3]=t("h3",{class:"text-sm font-medium text-muted-foreground mb-2"},"–í—Å–µ–≥–æ –∑–∞—è–≤–æ–∫",-1)),t("p",wr,m(o.statistics.total_consultations||0),1)]),t("div",hr,[e[4]||(e[4]=t("h3",{class:"text-sm font-medium text-muted-foreground mb-2"},"–°–∫–∞—á–∏–≤–∞–Ω–∏–π –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤",-1)),t("p",Cr,m(o.statistics.materials_downloads||0),1)])])):f("",!0),!o.loading&&o.statistics?(s(),d("div",Mr,[e[8]||(e[8]=t("h3",{class:"text-lg font-semibold mb-4"},"–ó–∞—è–≤–∫–∏ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º",-1)),t("div",Sr,[t("div",null,[e[5]||(e[5]=t("p",{class:"text-sm text-muted-foreground"},"–ù–æ–≤—ã–µ",-1)),t("p",Dr,m(o.statistics.consultations_by_status?.new||0),1)]),t("div",null,[e[6]||(e[6]=t("p",{class:"text-sm text-muted-foreground"},"–í —Ä–∞–±–æ—Ç–µ",-1)),t("p",Fr,m(o.statistics.consultations_by_status?.in_progress||0),1)]),t("div",null,[e[7]||(e[7]=t("p",{class:"text-sm text-muted-foreground"},"–ó–∞–∫—Ä—ã—Ç—ã–µ",-1)),t("p",Ur,m(o.statistics.consultations_by_status?.closed||0),1)])])])):f("",!0),!o.loading&&o.statistics&&o.statistics.popular_materials?.length>0?(s(),d("div",Vr,[e[9]||(e[9]=t("h3",{class:"text-lg font-semibold mb-4"},"–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã",-1)),t("div",Br,[(s(!0),d(B,null,T(o.statistics.popular_materials,r=>(s(),d("div",{key:r.id,class:"flex items-center justify-between p-3 bg-muted/30 rounded-lg"},[t("p",Tr,m(r.title),1),t("p",Ir,m(r.download_count||0)+" —Å–∫–∞—á–∏–≤–∞–Ω–∏–π",1)]))),128))])])):f("",!0)])}const Er=E(cr,[["render",jr]]),qr={name:"BotManagement",components:{ConsultationTable:ct,MaterialCategoryTree:Ho,BotSettingsForm:br,BotStatistics:Er},setup(){const n=ke(),e=ye(()=>n.params.botId),i=b(!1),o=b(null),v=b(null),k=b("consultations"),r=[{key:"consultations",label:"–ó–∞—è–≤–∫–∏"},{key:"materials",label:"–ú–∞—Ç–µ—Ä–∏–∞–ª—ã"},{key:"settings",label:"–ù–∞—Å—Ç—Ä–æ–π–∫–∏"},{key:"statistics",label:"–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞"}],l=async()=>{i.value=!0,o.value=null;try{const y=await j(`/bots/${e.value}`);if(!y.ok){const w=await y.json().catch(()=>({}));throw new Error(w.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–æ—Ç–∞")}const x=await y.json();v.value=x.data||null}catch(y){o.value=y.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–æ—Ç–∞"}finally{i.value=!1}};return R(()=>{l()}),{botId:e,loading:i,error:o,bot:v,activeTab:k,tabs:r,fetchBot:l}}},Pr={class:"bot-management-page space-y-6"},zr={class:"flex items-center justify-between"},Ar={key:0,class:"text-muted-foreground mt-1"},Nr={key:0,class:"flex items-center justify-center py-12"},Lr={key:1,class:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg"},Or={class:"text-destructive"},Rr={key:2,class:"bg-card rounded-lg border border-border"},Gr={class:"border-b border-border"},Hr={class:"flex -mb-px"},Kr=["onClick"],Qr={class:"p-6"},Jr={key:0},Wr={key:1},Xr={key:2},Yr={key:3};function Zr(n,e,i,o,v,k){const r=V("ConsultationTable"),l=V("MaterialCategoryTree"),y=V("BotSettingsForm"),x=V("BotStatistics");return s(),d("div",Pr,[t("div",zr,[t("div",null,[e[1]||(e[1]=t("h1",{class:"text-3xl font-semibold text-foreground"},"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–æ—Ç–æ–º",-1)),o.bot?(s(),d("p",Ar,m(o.bot.name),1)):f("",!0)]),t("button",{onClick:e[0]||(e[0]=w=>n.$router.push({name:"admin.bots"})),class:"h-11 px-6 bg-accent/10 backdrop-blur-xl text-accent border border-accent/40 hover:bg-accent/20 rounded-2xl shadow-lg shadow-accent/10 inline-flex items-center justify-center gap-2"}," ‚Üê –ù–∞–∑–∞–¥ –∫ –±–æ—Ç–∞–º ")]),o.loading?(s(),d("div",Nr,[...e[2]||(e[2]=[t("p",{class:"text-muted-foreground"},"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...",-1)])])):f("",!0),o.error?(s(),d("div",Lr,[t("p",Or,m(o.error),1)])):f("",!0),!o.loading&&o.bot?(s(),d("div",Rr,[t("div",Gr,[t("nav",Hr,[(s(!0),d(B,null,T(o.tabs,w=>(s(),d("button",{key:w.key,onClick:u=>o.activeTab=w.key,class:L(["px-6 py-4 text-sm font-medium border-b-2 transition-colors",o.activeTab===w.key?"border-accent text-accent":"border-transparent text-muted-foreground hover:text-foreground hover:border-muted-foreground"])},m(w.label),11,Kr))),128))])]),t("div",Qr,[o.activeTab==="consultations"?(s(),d("div",Jr,[N(r,{"bot-id":o.botId},null,8,["bot-id"])])):f("",!0),o.activeTab==="materials"?(s(),d("div",Wr,[N(l,{"bot-id":o.botId},null,8,["bot-id"])])):f("",!0),o.activeTab==="settings"?(s(),d("div",Xr,[N(y,{"bot-id":o.botId,onUpdated:o.fetchBot},null,8,["bot-id","onUpdated"])])):f("",!0),o.activeTab==="statistics"?(s(),d("div",Yr,[N(x,{"bot-id":o.botId},null,8,["bot-id"])])):f("",!0)])])):f("",!0)])}const rl=E(qr,[["render",Zr]]);export{rl as default};
