import{_ as E,c as r,a as t,b as c,d as _,C as h,F as w,q as y,t as d,r as f,k as S,o as n,p as V,e as M}from"./admin-DlhFhcao.js";import{a as k,c as C}from"./api-DccBIR6h.js";import{S as m}from"./sweetalert2.esm.all-C0u8rGqG.js";const T={name:"AdminRequests",setup(){const p=f(!1),s=f(null),v=f([]),o=f([]),u=f({status:"",bot_id:""}),b=async()=>{try{const a=await k("/bots");if(a.ok){const l=await a.json();o.value=l.data||[]}}catch(a){console.error("Error fetching bots:",a)}},e=async()=>{p.value=!0,s.value=null;try{const a=new URLSearchParams;u.value.status&&a.append("status",u.value.status),u.value.bot_id&&a.append("bot_id",u.value.bot_id);const l=await k(`/admin-requests?${a.toString()}`);if(!l.ok)throw new Error("Ошибка загрузки заявок");const i=await l.json();v.value=i.data?.requests||[]}catch(a){s.value=a.message||"Ошибка загрузки заявок"}finally{p.value=!1}},g=async a=>{const{value:l}=await m.fire({title:"Одобрить заявку",html:`
                    <textarea id="swal-notes" class="swal2-textarea" placeholder="Примечание (необязательно)"></textarea>
                `,focusConfirm:!1,showCancelButton:!0,confirmButtonText:"Одобрить",cancelButtonText:"Отмена",preConfirm:()=>({admin_notes:document.getElementById("swal-notes").value||null})});l&&await j(a.id,l)},R=async a=>{const{value:l}=await m.fire({title:"Отклонить заявку",html:`
                    <textarea id="swal-notes" class="swal2-textarea" placeholder="Причина отклонения (необязательно)"></textarea>
                `,focusConfirm:!1,showCancelButton:!0,confirmButtonText:"Отклонить",cancelButtonText:"Отмена",preConfirm:()=>({admin_notes:document.getElementById("swal-notes").value||null})});l&&await B(a.id,l)},j=async(a,l)=>{try{const i=await C(`/admin-requests/${a}/approve`,l);if(!i.ok){const x=await i.json().catch(()=>({}));throw new Error(x.message||"Ошибка одобрения заявки")}await m.fire({title:"Успешно",text:"Заявка одобрена, пользователю назначена роль администратора",icon:"success"}),e()}catch(i){m.fire({title:"Ошибка",text:i.message||"Ошибка одобрения заявки",icon:"error"})}},B=async(a,l)=>{try{const i=await C(`/admin-requests/${a}/reject`,l);if(!i.ok){const x=await i.json().catch(()=>({}));throw new Error(x.message||"Ошибка отклонения заявки")}await m.fire({title:"Успешно",text:"Заявка отклонена",icon:"success"}),e()}catch(i){m.fire({title:"Ошибка",text:i.message||"Ошибка отклонения заявки",icon:"error"})}},D=a=>a?new Date(a).toLocaleString("ru-RU"):"";return S(()=>{b(),e()}),{loading:p,error:s,requests:v,bots:o,filters:u,fetchRequests:e,showApproveModal:g,showRejectModal:R,formatDate:D}}},U={class:"admin-requests-page space-y-6"},A={class:"bg-card rounded-lg border border-border p-4"},I={class:"flex gap-4 items-end"},L={class:"flex-1"},N={class:"flex-1"},F=["value"],P={key:0,class:"flex items-center justify-center py-12"},z={key:1,class:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg"},G={class:"text-destructive"},H={key:2,class:"bg-card rounded-lg border border-border overflow-hidden"},J={key:0,class:"text-center py-12 text-muted-foreground"},K={key:1,class:"divide-y divide-border"},O={class:"flex items-start justify-between"},Q={class:"flex-1"},W={class:"flex items-center gap-3 mb-2"},X={class:"text-lg font-semibold"},Y={class:"space-y-1 text-sm text-muted-foreground"},Z={key:0},q={key:1},$={key:2},ee={key:3},te={key:4,class:"mt-2 text-foreground"},se={key:0,class:"flex gap-2 ml-4"},oe=["onClick"],ae=["onClick"];function re(p,s,v,o,u,b){return n(),r("div",U,[s[10]||(s[10]=t("div",{class:"flex items-center justify-between"},[t("div",null,[t("h1",{class:"text-3xl font-semibold text-foreground"},"Заявки на администратора"),t("p",{class:"text-muted-foreground mt-1"},"Управление заявками на назначение администратором")])],-1)),t("div",A,[t("div",I,[t("div",L,[s[5]||(s[5]=t("label",{class:"block text-sm font-medium mb-2"},"Статус",-1)),_(t("select",{"onUpdate:modelValue":s[0]||(s[0]=e=>o.filters.status=e),onChange:s[1]||(s[1]=(...e)=>o.fetchRequests&&o.fetchRequests(...e)),class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},[...s[4]||(s[4]=[t("option",{value:""},"Все",-1),t("option",{value:"pending"},"Ожидают",-1),t("option",{value:"approved"},"Одобрены",-1),t("option",{value:"rejected"},"Отклонены",-1)])],544),[[h,o.filters.status]])]),t("div",N,[s[7]||(s[7]=t("label",{class:"block text-sm font-medium mb-2"},"Бот",-1)),_(t("select",{"onUpdate:modelValue":s[2]||(s[2]=e=>o.filters.bot_id=e),onChange:s[3]||(s[3]=(...e)=>o.fetchRequests&&o.fetchRequests(...e)),class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},[s[6]||(s[6]=t("option",{value:""},"Все боты",-1)),(n(!0),r(w,null,y(o.bots,e=>(n(),r("option",{key:e.id,value:e.id},d(e.name),9,F))),128))],544),[[h,o.filters.bot_id]])])])]),o.loading?(n(),r("div",P,[...s[8]||(s[8]=[t("p",{class:"text-muted-foreground"},"Загрузка заявок...",-1)])])):c("",!0),o.error?(n(),r("div",z,[t("p",G,d(o.error),1)])):c("",!0),!o.loading&&!o.error?(n(),r("div",H,[o.requests.length===0?(n(),r("div",J," Заявки не найдены ")):(n(),r("div",K,[(n(!0),r(w,null,y(o.requests,e=>(n(),r("div",{key:e.id,class:"p-6 hover:bg-muted/10 transition-colors"},[t("div",O,[t("div",Q,[t("div",W,[t("h3",X,d(e.full_name),1),t("span",{class:V(["px-2 py-1 text-xs rounded",e.status==="pending"?"bg-yellow-500/10 text-yellow-600":e.status==="approved"?"bg-green-500/10 text-green-600":"bg-red-500/10 text-red-600"])},d(e.status==="pending"?"Ожидает":e.status==="approved"?"Одобрена":"Отклонена"),3)]),t("div",Y,[t("p",null,"Telegram ID: "+d(e.telegram_user_id),1),e.username?(n(),r("p",Z,"Username: @"+d(e.username),1)):c("",!0),e.bot?(n(),r("p",q,"Бот: "+d(e.bot.name),1)):c("",!0),t("p",null,"Создана: "+d(o.formatDate(e.created_at)),1),e.approved_at?(n(),r("p",$,"Обработана: "+d(o.formatDate(e.approved_at)),1)):c("",!0),e.approver?(n(),r("p",ee,"Обработал: "+d(e.approver.name),1)):c("",!0),e.admin_notes?(n(),r("p",te,[s[9]||(s[9]=t("strong",null,"Примечание:",-1)),M(" "+d(e.admin_notes),1)])):c("",!0)])]),e.status==="pending"?(n(),r("div",se,[t("button",{onClick:g=>o.showApproveModal(e),class:"px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg text-sm"}," Одобрить ",8,oe),t("button",{onClick:g=>o.showRejectModal(e),class:"px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg text-sm"}," Отклонить ",8,ae)])):c("",!0)])]))),128))]))])):c("",!0)])}const de=E(T,[["render",re]]);export{de as default};
