import{_ as j,r as f,c as r,a as t,t as m,b as c,d as b,C as z,v,o as l,n as O,k as D,x as H,F as U,q as F,h as E,p as A,w as J,D as W,f as P,e as K,m as Y,l as Z}from"./admin-BsqY0Bzo.js";import{b as q,a as T,c as X,d as Q}from"./api-DccBIR6h.js";import{S as h}from"./sweetalert2.esm.all-C0u8rGqG.js";import $ from"./Media-BerqVsc4.js";const ee={name:"ConsultationDetail",props:{consultation:{type:Object,required:!0},botId:{type:[String,Number],required:!0}},emits:["close","updated"],setup(d,{emit:e}){const u=f(!1),o=f({status:d.consultation.status,admin_notes:d.consultation.admin_notes||""});return{form:o,saving:u,saveConsultation:async()=>{u.value=!0;try{const s=await q(`/bot-management/${d.botId}/consultations/${d.consultation.id}`,o.value);if(!s.ok){const n=await s.json().catch(()=>({}));throw new Error(n.message||"–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è")}await h.fire({title:"–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ",icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"}),e("updated"),e("close")}catch(s){h.fire({title:"–û—à–∏–±–∫–∞",text:s.message||"–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è",icon:"error",confirmButtonText:"–û–ö"})}finally{u.value=!1}},formatDate:s=>new Date(s).toLocaleString("ru-RU")}}},te={class:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4"},oe={class:"bg-background border border-border rounded-lg shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto"},se={class:"sticky top-0 bg-background border-b border-border p-6"},le={class:"flex items-center justify-between"},re={class:"text-lg font-semibold"},ne={class:"p-6 space-y-6"},de={key:0},ae={class:"bg-muted/30 rounded-lg p-4"},ie={class:"text-sm"},ue={key:0,class:"text-sm"},me={key:1,class:"text-sm"},be={class:"space-y-3"},ce={class:"text-sm"},fe={class:"text-sm"},ge={key:0},xe={class:"text-sm whitespace-pre-wrap"},ve={class:"text-sm"},pe={class:"flex gap-2 pt-4 border-t border-border"},_e=["disabled"];function ye(d,e,u,o,p,y){return l(),r("div",te,[t("div",oe,[t("div",se,[t("div",le,[t("h3",re,"–î–µ—Ç–∞–ª–∏ –∑–∞—è–≤–∫–∏ #"+m(u.consultation.id),1),t("button",{onClick:e[0]||(e[0]=s=>d.$emit("close")),class:"text-muted-foreground hover:text-foreground"}," ‚úï ")])]),t("div",ne,[u.consultation.user?(l(),r("div",de,[e[5]||(e[5]=t("h4",{class:"text-sm font-medium text-muted-foreground mb-2"},"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å",-1)),t("div",ae,[t("p",ie,"ID: "+m(u.consultation.user.telegram_user_id),1),u.consultation.user.username?(l(),r("p",ue,"@"+m(u.consultation.user.username),1)):c("",!0),u.consultation.user.first_name?(l(),r("p",me,m(u.consultation.user.first_name)+" "+m(u.consultation.user.last_name||""),1)):c("",!0)])])):c("",!0),t("div",null,[e[13]||(e[13]=t("h4",{class:"text-sm font-medium text-muted-foreground mb-2"},"–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞—è–≤–∫–µ",-1)),t("div",be,[t("div",null,[e[6]||(e[6]=t("label",{class:"block text-xs text-muted-foreground mb-1"},"–ò–º—è",-1)),t("p",ce,m(u.consultation.name),1)]),t("div",null,[e[7]||(e[7]=t("label",{class:"block text-xs text-muted-foreground mb-1"},"–¢–µ–ª–µ—Ñ–æ–Ω",-1)),t("p",fe,m(u.consultation.phone),1)]),u.consultation.description?(l(),r("div",ge,[e[8]||(e[8]=t("label",{class:"block text-xs text-muted-foreground mb-1"},"–û–ø–∏—Å–∞–Ω–∏–µ",-1)),t("p",xe,m(u.consultation.description),1)])):c("",!0),t("div",null,[e[10]||(e[10]=t("label",{class:"block text-xs text-muted-foreground mb-1"},"–°—Ç–∞—Ç—É—Å",-1)),b(t("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>o.form.status=s),class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},[...e[9]||(e[9]=[t("option",{value:"new"},"–ù–æ–≤–∞—è",-1),t("option",{value:"in_progress"},"–í —Ä–∞–±–æ—Ç–µ",-1),t("option",{value:"closed"},"–ó–∞–∫—Ä—ã—Ç–∞",-1)])],512),[[z,o.form.status]])]),t("div",null,[e[11]||(e[11]=t("label",{class:"block text-xs text-muted-foreground mb-1"},"–ü—Ä–∏–º–µ—á–∞–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞",-1)),b(t("textarea",{"onUpdate:modelValue":e[2]||(e[2]=s=>o.form.admin_notes=s),rows:"4",class:"w-full px-3 py-2 border border-border rounded-lg bg-background resize-none",placeholder:"–í–≤–µ–¥–∏—Ç–µ –ø—Ä–∏–º–µ—á–∞–Ω–∏—è..."},null,512),[[v,o.form.admin_notes]])]),t("div",null,[e[12]||(e[12]=t("label",{class:"block text-xs text-muted-foreground mb-1"},"–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è",-1)),t("p",ve,m(o.formatDate(u.consultation.created_at)),1)])])]),t("div",pe,[t("button",{onClick:e[3]||(e[3]=s=>d.$emit("close")),class:"flex-1 h-10 px-4 border border-border bg-background/50 hover:bg-accent/10 rounded-lg"}," –û—Ç–º–µ–Ω–∞ "),t("button",{onClick:e[4]||(e[4]=(...s)=>o.saveConsultation&&o.saveConsultation(...s)),disabled:o.saving,class:"flex-1 h-10 px-4 bg-accent/10 backdrop-blur-xl text-accent border border-accent/40 hover:bg-accent/20 rounded-lg disabled:opacity-50"},m(o.saving?"–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...":"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"),9,_e)])])])])}const ke=j(ee,[["render",ye]]),we={name:"ConsultationTable",components:{ConsultationDetail:ke},props:{botId:{type:[String,Number],required:!0}},setup(d){const e=f(!1),u=f([]),o=f(null),p=f(1),y=f(20),s=f(0),n=f({status:"",date_from:"",date_to:""}),a=async()=>{e.value=!0;try{const w={page:p.value,per_page:y.value,...n.value},I=await T(`/bot-management/${d.botId}/consultations`,w);if(!I.ok)throw new Error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞—è–≤–æ–∫");const S=await I.json();u.value=S.data.consultations||[],s.value=S.data.total||0}catch(w){console.error("Error fetching consultations:",w)}finally{e.value=!1}},k=()=>{n.value={status:"",date_from:"",date_to:""},p.value=1,a()},M=w=>{o.value=w},C=w=>({new:"–ù–æ–≤–∞—è",in_progress:"–í —Ä–∞–±–æ—Ç–µ",closed:"–ó–∞–∫—Ä—ã—Ç–∞"})[w]||w,x=w=>({new:"bg-blue-500/10 text-blue-500",in_progress:"bg-yellow-500/10 text-yellow-500",closed:"bg-green-500/10 text-green-500"})[w]||"bg-gray-500/10 text-gray-500",V=w=>new Date(w).toLocaleDateString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"});return O(p,()=>{a()}),D(()=>{a()}),{loading:e,consultations:u,selectedConsultation:o,currentPage:p,perPage:y,total:s,filters:n,fetchConsultations:a,resetFilters:k,showDetail:M,getStatusLabel:C,getStatusClass:x,formatDate:V}}},he={class:"consultation-table space-y-4"},Ce={class:"bg-muted/30 rounded-lg border border-border p-4"},Me={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},Be={class:"flex items-end"},Ie={key:0,class:"text-center py-12"},Se={key:1,class:"bg-background rounded-lg border border-border overflow-hidden"},Ue={class:"overflow-x-auto"},Fe={class:"w-full"},Ve={class:"divide-y divide-border"},Te={class:"px-6 py-4 text-sm"},Ee={class:"px-6 py-4 text-sm"},je={class:"px-6 py-4 text-sm"},qe={class:"px-6 py-4"},De={class:"px-6 py-4 text-sm"},Pe={class:"px-6 py-4 text-right"},ze=["onClick"],Ae={key:0,class:"px-6 py-4 border-t border-border flex items-center justify-between"},Ne={class:"text-sm text-muted-foreground"},Le={class:"flex gap-2"},Re=["disabled"],Ge=["disabled"];function Oe(d,e,u,o,p,y){const s=E("ConsultationDetail");return l(),r("div",he,[e[16]||(e[16]=t("div",{class:"flex items-center justify-between"},[t("h2",{class:"text-2xl font-semibold"},"–ó–∞—è–≤–∫–∏ –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é")],-1)),t("div",Ce,[t("div",Me,[t("div",null,[e[11]||(e[11]=t("label",{class:"block text-sm font-medium mb-2"},"–°—Ç–∞—Ç—É—Å",-1)),b(t("select",{"onUpdate:modelValue":e[0]||(e[0]=n=>o.filters.status=n),onChange:e[1]||(e[1]=(...n)=>o.fetchConsultations&&o.fetchConsultations(...n)),class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},[...e[10]||(e[10]=[t("option",{value:""},"–í—Å–µ",-1),t("option",{value:"new"},"–ù–æ–≤—ã–µ",-1),t("option",{value:"in_progress"},"–í —Ä–∞–±–æ—Ç–µ",-1),t("option",{value:"closed"},"–ó–∞–∫—Ä—ã—Ç—ã–µ",-1)])],544),[[z,o.filters.status]])]),t("div",null,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium mb-2"},"–î–∞—Ç–∞ –æ—Ç",-1)),b(t("input",{"onUpdate:modelValue":e[2]||(e[2]=n=>o.filters.date_from=n),type:"date",onChange:e[3]||(e[3]=(...n)=>o.fetchConsultations&&o.fetchConsultations(...n)),class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},null,544),[[v,o.filters.date_from]])]),t("div",null,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium mb-2"},"–î–∞—Ç–∞ –¥–æ",-1)),b(t("input",{"onUpdate:modelValue":e[4]||(e[4]=n=>o.filters.date_to=n),type:"date",onChange:e[5]||(e[5]=(...n)=>o.fetchConsultations&&o.fetchConsultations(...n)),class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},null,544),[[v,o.filters.date_to]])]),t("div",Be,[t("button",{onClick:e[6]||(e[6]=(...n)=>o.resetFilters&&o.resetFilters(...n)),class:"w-full h-10 px-4 border border-border bg-background hover:bg-muted/10 rounded-lg"}," –°–±—Ä–æ—Å–∏—Ç—å ")])])]),o.loading?(l(),r("div",Ie,[...e[14]||(e[14]=[t("p",{class:"text-muted-foreground"},"–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞—è–≤–æ–∫...",-1)])])):c("",!0),o.loading?c("",!0):(l(),r("div",Se,[t("div",Ue,[t("table",Fe,[e[15]||(e[15]=t("thead",{class:"bg-muted/30 border-b border-border"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase"},"ID"),t("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase"},"–ò–º—è"),t("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase"},"–¢–µ–ª–µ—Ñ–æ–Ω"),t("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase"},"–°—Ç–∞—Ç—É—Å"),t("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase"},"–î–∞—Ç–∞"),t("th",{class:"px-6 py-3 text-right text-xs font-medium uppercase"},"–î–µ–π—Å—Ç–≤–∏—è")])],-1)),t("tbody",Ve,[(l(!0),r(U,null,F(o.consultations,n=>(l(),r("tr",{key:n.id,class:"hover:bg-muted/10"},[t("td",Te,m(n.id),1),t("td",Ee,m(n.name),1),t("td",je,m(n.phone),1),t("td",qe,[t("span",{class:A(["px-2 py-1 text-xs rounded-md",o.getStatusClass(n.status)])},m(o.getStatusLabel(n.status)),3)]),t("td",De,m(o.formatDate(n.created_at)),1),t("td",Pe,[t("button",{onClick:a=>o.showDetail(n),class:"px-3 py-1 text-xs bg-blue-500 hover:bg-blue-600 text-white rounded"}," –î–µ—Ç–∞–ª–∏ ",8,ze)])]))),128))])])]),o.total>o.perPage?(l(),r("div",Ae,[t("div",Ne," –ü–æ–∫–∞–∑–∞–Ω–æ "+m((o.currentPage-1)*o.perPage+1)+" - "+m(Math.min(o.currentPage*o.perPage,o.total))+" –∏–∑ "+m(o.total),1),t("div",Le,[t("button",{onClick:e[7]||(e[7]=n=>o.currentPage--),disabled:o.currentPage===1,class:"px-4 py-2 border border-border rounded-lg disabled:opacity-50"}," –ù–∞–∑–∞–¥ ",8,Re),t("button",{onClick:e[8]||(e[8]=n=>o.currentPage++),disabled:o.currentPage*o.perPage>=o.total,class:"px-4 py-2 border border-border rounded-lg disabled:opacity-50"}," –í–ø–µ—Ä–µ–¥ ",8,Ge)])])):c("",!0)])),o.selectedConsultation?(l(),H(s,{key:2,consultation:o.selectedConsultation,"bot-id":u.botId,onClose:e[9]||(e[9]=n=>o.selectedConsultation=null),onUpdated:o.fetchConsultations},null,8,["consultation","bot-id","onUpdated"])):c("",!0)])}const Ke=j(we,[["render",Oe]]),Qe={name:"MaterialForm",props:{botId:{type:[String,Number],required:!0},categoryId:{type:[String,Number],default:null},material:{type:Object,default:null}},emits:["close","saved"],setup(d,{emit:e}){const u=f(!1),o=f(!1),p=f(!1),y=f(""),s=f([]),n=f(null),a=f(null),k=f(null),M=f(!!d.material),C=f([]),x=f({title:"",category_id:d.categoryId||null,description:"",file_type:"file",file_url:"",file_id:"",media_id:null,order_index:0,is_active:!0}),V=async()=>{try{const g=await T(`/bot-management/${d.botId}/materials/categories`);if(g.ok){const i=await g.json();C.value=i.data||[]}}catch(g){console.error("Error fetching categories:",g)}},w=async()=>{o.value=!0;try{const g={};y.value&&(g.search=y.value);const i=await T("/media",g);if(i.ok){const _=await i.json();s.value=_.data||[]}}catch(g){console.error("Error fetching media:",g)}finally{o.value=!1}},I=()=>{x.value.file_url="",x.value.file_id="",x.value.media_id=null,n.value=null,a.value=null},S=g=>{const i=g.target.files[0];i&&(n.value=i,x.value.media_id=null,a.value=null)},N=g=>{x.value.media_id=g.id,a.value=g,n.value=null},L=()=>{x.value.media_id&&(p.value=!1)},R=g=>{if(!g)return"0 B";const i=1024,_=["B","KB","MB","GB"],B=Math.floor(Math.log(g)/Math.log(i));return Math.round(g/Math.pow(i,B)*100)/100+" "+_[B]},G=async()=>{u.value=!0;try{const g=new FormData;if(g.append("title",x.value.title),g.append("category_id",x.value.category_id),g.append("description",x.value.description||""),g.append("file_type",x.value.file_type),g.append("order_index",x.value.order_index||0),g.append("is_active",x.value.is_active?1:0),x.value.file_type==="file")if(n.value)g.append("file",n.value);else if(x.value.media_id)g.append("media_id",x.value.media_id);else throw new Error("–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª –∏–ª–∏ —É–∫–∞–∑–∞—Ç—å —Ñ–∞–π–ª –∏–∑ –º–µ–¥–∏–∞-–±–∏–±–ª–∏–æ—Ç–µ–∫–∏");else x.value.file_type==="url"?g.append("file_url",x.value.file_url):x.value.file_type==="telegram_file_id"&&g.append("file_id",x.value.file_id);let i;if(M.value?i=await q(`/bot-management/${d.botId}/materials/${d.material.id}`,g):i=await X(`/bot-management/${d.botId}/materials`,g),!i.ok){const _=await i.json().catch(()=>({}));throw new Error(_.message||"–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–∞")}await h.fire({title:"–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ",icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"}),e("saved"),e("close")}catch(g){h.fire({title:"–û—à–∏–±–∫–∞",text:g.message||"–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–∞",icon:"error",confirmButtonText:"–û–ö"})}finally{u.value=!1}};return d.material&&(x.value={title:d.material.title||"",category_id:d.material.category_id||d.categoryId||null,description:d.material.description||"",file_type:d.material.file_type||"file",file_url:d.material.file_url||"",file_id:d.material.file_id||"",media_id:d.material.media_id||null,order_index:d.material.order_index||0,is_active:d.material.is_active!==void 0?d.material.is_active:!0},d.material.media&&(a.value=d.material.media)),O(p,g=>{g&&w()}),O(y,()=>{p.value&&w()}),D(()=>{V()}),{saving:u,loadingMedia:o,showMediaPicker:p,mediaSearch:y,mediaFiles:s,selectedFile:n,selectedMedia:a,fileInput:k,isEditMode:M,categories:C,form:x,fetchMediaFiles:w,handleFileTypeChange:I,handleFileSelect:S,selectMedia:N,confirmMediaSelection:L,formatFileSize:R,saveMaterial:G}}},He={class:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4"},Je={class:"bg-background border border-border rounded-lg shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-y-auto"},We={class:"sticky top-0 bg-background border-b border-border p-6"},Xe={class:"flex items-center justify-between"},Ye={class:"text-lg font-semibold"},Ze=["value"],$e={key:0},et={class:"space-y-3"},tt={key:0,class:"text-xs text-muted-foreground mt-1"},ot={key:0,class:"text-xs text-muted-foreground mt-1"},st={key:1},lt={key:2},rt={class:"flex items-center gap-2"},nt={class:"flex gap-4 pt-4 border-t border-border"},dt=["disabled"],at={key:0,class:"fixed inset-0 z-[60] flex items-center justify-center bg-black/90 p-4"},it={class:"bg-background border border-border rounded-lg shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col"},ut={class:"p-6 border-b border-border"},mt={class:"flex items-center justify-between"},bt={class:"flex-1 overflow-y-auto p-6"},ct={key:0,class:"text-center py-12"},ft={key:1,class:"text-center py-12 text-muted-foreground"},gt={key:2,class:"grid grid-cols-2 md:grid-cols-4 gap-4"},xt=["onClick"],vt={class:"text-sm font-medium truncate"},pt={class:"text-xs text-muted-foreground mt-1"},_t={class:"p-6 border-t border-border"},yt=["disabled"];function kt(d,e,u,o,p,y){return l(),r("div",He,[t("div",Je,[t("div",We,[t("div",Xe,[t("h3",Ye,m(o.isEditMode?"–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª":"–°–æ–∑–¥–∞—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª"),1),t("button",{onClick:e[0]||(e[0]=s=>d.$emit("close")),class:"text-muted-foreground hover:text-foreground"}," ‚úï ")])]),t("form",{onSubmit:e[13]||(e[13]=J((...s)=>o.saveMaterial&&o.saveMaterial(...s),["prevent"])),class:"p-6 space-y-6"},[t("div",null,[e[17]||(e[17]=t("label",{class:"block text-sm font-medium mb-2"},"–ù–∞–∑–≤–∞–Ω–∏–µ *",-1)),b(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>o.form.title=s),type:"text",required:"",placeholder:"–ù–∞–∑–≤–∞–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–∞",class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},null,512),[[v,o.form.title]])]),t("div",null,[e[19]||(e[19]=t("label",{class:"block text-sm font-medium mb-2"},"–ö–∞—Ç–µ–≥–æ—Ä–∏—è *",-1)),b(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>o.form.category_id=s),required:"",class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},[e[18]||(e[18]=t("option",{value:""},"–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é",-1)),(l(!0),r(U,null,F(o.categories,s=>(l(),r("option",{key:s.id,value:s.id},m(s.name),9,Ze))),128))],512),[[z,o.form.category_id,void 0,{number:!0}]])]),t("div",null,[e[20]||(e[20]=t("label",{class:"block text-sm font-medium mb-2"},"–û–ø–∏—Å–∞–Ω–∏–µ",-1)),b(t("textarea",{"onUpdate:modelValue":e[3]||(e[3]=s=>o.form.description=s),rows:"4",placeholder:"–û–ø–∏—Å–∞–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–∞...",class:"w-full px-3 py-2 border border-border rounded-lg bg-background resize-none"},null,512),[[v,o.form.description]])]),t("div",null,[e[22]||(e[22]=t("label",{class:"block text-sm font-medium mb-2"},"–¢–∏–ø —Ñ–∞–π–ª–∞ *",-1)),b(t("select",{"onUpdate:modelValue":e[4]||(e[4]=s=>o.form.file_type=s),required:"",onChange:e[5]||(e[5]=(...s)=>o.handleFileTypeChange&&o.handleFileTypeChange(...s)),class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},[...e[21]||(e[21]=[t("option",{value:"file"},"–§–∞–π–ª (–∑–∞–≥—Ä—É–∑–∫–∞ –∏–ª–∏ –∏–∑ –º–µ–¥–∏–∞-–±–∏–±–ª–∏–æ—Ç–µ–∫–∏)",-1),t("option",{value:"url"},"–í–Ω–µ—à–Ω—è—è —Å—Å—ã–ª–∫–∞",-1),t("option",{value:"telegram_file_id"},"Telegram file_id",-1)])],544),[[z,o.form.file_type]])]),o.form.file_type==="file"?(l(),r("div",$e,[e[26]||(e[26]=t("label",{class:"block text-sm font-medium mb-2"},"–§–∞–π–ª",-1)),t("div",et,[t("div",null,[e[23]||(e[23]=t("label",{class:"block text-xs text-muted-foreground mb-2"}," –ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤—ã–π —Ñ–∞–π–ª ",-1)),t("input",{ref:"fileInput",type:"file",onChange:e[6]||(e[6]=(...s)=>o.handleFileSelect&&o.handleFileSelect(...s)),class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},null,544),o.selectedFile?(l(),r("p",tt," –í—ã–±—Ä–∞–Ω: "+m(o.selectedFile.name),1)):c("",!0)]),e[25]||(e[25]=t("div",{class:"text-center text-sm text-muted-foreground"},"–∏–ª–∏",-1)),t("div",null,[e[24]||(e[24]=t("label",{class:"block text-xs text-muted-foreground mb-2"}," –í—ã–±—Ä–∞—Ç—å –∏–∑ –º–µ–¥–∏–∞-–±–∏–±–ª–∏–æ—Ç–µ–∫–∏ ",-1)),t("button",{type:"button",onClick:e[7]||(e[7]=s=>o.showMediaPicker=!0),class:"w-full h-10 px-4 border border-border rounded-lg bg-background hover:bg-muted/10"},m(o.form.media_id?"–§–∞–π–ª –≤—ã–±—Ä–∞–Ω":"–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª"),1),o.selectedMedia?(l(),r("p",ot," –í—ã–±—Ä–∞–Ω: "+m(o.selectedMedia.name),1)):c("",!0)])])])):c("",!0),o.form.file_type==="url"?(l(),r("div",st,[e[27]||(e[27]=t("label",{class:"block text-sm font-medium mb-2"},"URL *",-1)),b(t("input",{"onUpdate:modelValue":e[8]||(e[8]=s=>o.form.file_url=s),type:"url",required:"",placeholder:"https://example.com/file.pdf",class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},null,512),[[v,o.form.file_url]])])):c("",!0),o.form.file_type==="telegram_file_id"?(l(),r("div",lt,[e[28]||(e[28]=t("label",{class:"block text-sm font-medium mb-2"},"Telegram file_id *",-1)),b(t("input",{"onUpdate:modelValue":e[9]||(e[9]=s=>o.form.file_id=s),type:"text",required:"",placeholder:"BQACAgIAAxkBAAI...",class:"w-full h-10 px-3 border border-border rounded-lg bg-background font-mono text-sm"},null,512),[[v,o.form.file_id]]),e[29]||(e[29]=t("p",{class:"text-xs text-muted-foreground mt-1"}," –ü–æ–ª—É—á–∏—Ç—å file_id –º–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏–≤ —Ñ–∞–π–ª –±–æ—Ç—É –∏ –ø—Ä–æ–≤–µ—Ä–∏–≤ –æ—Ç–≤–µ—Ç API ",-1))])):c("",!0),t("div",null,[e[30]||(e[30]=t("label",{class:"block text-sm font-medium mb-2"},"–ü–æ—Ä—è–¥–æ–∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è",-1)),b(t("input",{"onUpdate:modelValue":e[10]||(e[10]=s=>o.form.order_index=s),type:"number",min:"0",placeholder:"0",class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},null,512),[[v,o.form.order_index,void 0,{number:!0}]])]),t("div",null,[t("label",rt,[b(t("input",{"onUpdate:modelValue":e[11]||(e[11]=s=>o.form.is_active=s),type:"checkbox",class:"w-4 h-4"},null,512),[[W,o.form.is_active]]),e[31]||(e[31]=t("span",null,"–ú–∞—Ç–µ—Ä–∏–∞–ª –∞–∫—Ç–∏–≤–µ–Ω",-1))])]),t("div",nt,[t("button",{type:"button",onClick:e[12]||(e[12]=s=>d.$emit("close")),class:"flex-1 h-10 px-4 border border-border bg-background/50 hover:bg-accent/10 rounded-lg"}," –û—Ç–º–µ–Ω–∞ "),t("button",{type:"submit",disabled:o.saving,class:"flex-1 h-10 px-4 bg-accent/10 backdrop-blur-xl text-accent border border-accent/40 hover:bg-accent/20 rounded-lg disabled:opacity-50"},m(o.saving?"–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...":"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"),9,dt)])],32),o.showMediaPicker?(l(),r("div",at,[t("div",it,[t("div",ut,[t("div",mt,[e[32]||(e[32]=t("h3",{class:"text-lg font-semibold"},"–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –∏–∑ –º–µ–¥–∏–∞-–±–∏–±–ª–∏–æ—Ç–µ–∫–∏",-1)),t("button",{onClick:e[14]||(e[14]=s=>o.showMediaPicker=!1),class:"text-muted-foreground hover:text-foreground"}," ‚úï ")]),b(t("input",{"onUpdate:modelValue":e[15]||(e[15]=s=>o.mediaSearch=s),type:"text",placeholder:"–ü–æ–∏—Å–∫ —Ñ–∞–π–ª–∞...",class:"w-full mt-4 h-10 px-3 border border-border rounded-lg bg-background"},null,512),[[v,o.mediaSearch]])]),t("div",bt,[o.loadingMedia?(l(),r("div",ct,[...e[33]||(e[33]=[t("p",{class:"text-muted-foreground"},"–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤...",-1)])])):o.mediaFiles.length===0?(l(),r("div",ft," –§–∞–π–ª—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã ")):(l(),r("div",gt,[(l(!0),r(U,null,F(o.mediaFiles,s=>(l(),r("div",{key:s.id,onClick:n=>o.selectMedia(s),class:A(["p-4 border rounded-lg cursor-pointer transition-colors",o.form.media_id===s.id?"border-accent bg-accent/10":"border-border hover:bg-muted/10"])},[t("div",vt,m(s.name),1),t("div",pt,m(o.formatFileSize(s.size)),1)],10,xt))),128))]))]),t("div",_t,[t("button",{onClick:e[16]||(e[16]=(...s)=>o.confirmMediaSelection&&o.confirmMediaSelection(...s)),disabled:!o.form.media_id,class:"w-full h-10 px-4 bg-accent/10 backdrop-blur-xl text-accent border border-accent/40 hover:bg-accent/20 rounded-lg disabled:opacity-50"}," –í—ã–±—Ä–∞—Ç—å ",8,yt)])])])):c("",!0)])])}const wt=j(Qe,[["render",kt]]),ht={name:"MaterialCategoryTree",components:{MaterialForm:wt,Media:$},props:{botId:{type:[String,Number],required:!0}},setup(d){const e=f(!1),u=f([]),o=f(!1),p=f(!1),y=f(null),s=f(null),n=async()=>{e.value=!0;try{const i=await T(`/bot-management/${d.botId}/materials/categories`);if(!i.ok)throw new Error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π");const _=await i.json();u.value=_.data||[];for(const B of u.value)await k(B)}catch(i){console.error("Error fetching categories:",i)}finally{e.value=!1}},a=async()=>{const{value:i}=await h.fire({title:"–°–æ–∑–¥–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é",html:`
                    <input id="swal-icon" class="swal2-input" placeholder="–ò–∫–æ–Ω–∫–∞ (—ç–º–æ–¥–∑–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä: üß©)" maxlength="10">
                    <input id="swal-name" class="swal2-input" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" required>
                    <textarea id="swal-description" class="swal2-textarea" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ"></textarea>
                    <input id="swal-order" class="swal2-input" type="number" placeholder="–ü–æ—Ä—è–¥–æ–∫" value="0">
                `,focusConfirm:!1,showCancelButton:!0,confirmButtonText:"–°–æ–∑–¥–∞—Ç—å",cancelButtonText:"–û—Ç–º–µ–Ω–∞",preConfirm:()=>{const _=document.getElementById("swal-name").value;return _?{name:_,icon:document.getElementById("swal-icon").value||null,description:document.getElementById("swal-description").value,order_index:parseInt(document.getElementById("swal-order").value)||0}:(h.showValidationMessage("–ù–∞–∑–≤–∞–Ω–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ"),!1)}});if(i)try{if(!(await X(`/bot-management/${d.botId}/materials/categories`,i)).ok)throw new Error("–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏");await h.fire({title:"–°–æ–∑–¥–∞–Ω–æ",icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"}),n(),o.value=!1}catch(_){h.fire({title:"–û—à–∏–±–∫–∞",text:_.message||"–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏",icon:"error"})}},k=async i=>{try{const _=await T(`/bot-management/${d.botId}/materials`,{category_id:i.id});if(_.ok){const B=await _.json();i.materials=B.data||[]}}catch(_){console.error("Error fetching materials:",_)}},M=async i=>{if((await h.fire({title:"–£–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é?",text:`–ö–∞—Ç–µ–≥–æ—Ä–∏—è "${i.name}" –∏ –≤—Å–µ –µ—ë –º–∞—Ç–µ—Ä–∏–∞–ª—ã –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.`,icon:"warning",showCancelButton:!0,confirmButtonText:"–£–¥–∞–ª–∏—Ç—å",cancelButtonText:"–û—Ç–º–µ–Ω–∞"})).isConfirmed)try{if(!(await Q(`/bot-management/${d.botId}/materials/categories/${i.id}`)).ok)throw new Error("–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏");await h.fire({title:"–£–¥–∞–ª–µ–Ω–æ",icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"}),n()}catch(B){h.fire({title:"–û—à–∏–±–∫–∞",text:B.message||"–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏",icon:"error"})}},C=async i=>{if((await h.fire({title:"–£–¥–∞–ª–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª?",text:`–ú–∞—Ç–µ—Ä–∏–∞–ª "${i.title}" –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω.`,icon:"warning",showCancelButton:!0,confirmButtonText:"–£–¥–∞–ª–∏—Ç—å",cancelButtonText:"–û—Ç–º–µ–Ω–∞"})).isConfirmed)try{if(!(await Q(`/bot-management/${d.botId}/materials/${i.id}`)).ok)throw new Error("–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–∞");await h.fire({title:"–£–¥–∞–ª–µ–Ω–æ",icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"}),n()}catch(B){h.fire({title:"–û—à–∏–±–∫–∞",text:B.message||"–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–∞",icon:"error"})}},x=async i=>{const{value:_}=await h.fire({title:"–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é",html:`
                    <input id="swal-icon" class="swal2-input" placeholder="–ò–∫–æ–Ω–∫–∞ (—ç–º–æ–¥–∑–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä: üß©)" value="${i.icon||""}" maxlength="10">
                    <input id="swal-name" class="swal2-input" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" value="${i.name}">
                    <textarea id="swal-description" class="swal2-textarea" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ">${i.description||""}</textarea>
                    <input id="swal-order" class="swal2-input" type="number" placeholder="–ü–æ—Ä—è–¥–æ–∫" value="${i.order_index}">
                `,focusConfirm:!1,showCancelButton:!0,confirmButtonText:"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å",cancelButtonText:"–û—Ç–º–µ–Ω–∞",preConfirm:()=>({name:document.getElementById("swal-name").value,icon:document.getElementById("swal-icon").value||null,description:document.getElementById("swal-description").value,order_index:parseInt(document.getElementById("swal-order").value)||0})});if(_)try{if(!(await q(`/bot-management/${d.botId}/materials/categories/${i.id}`,_)).ok)throw new Error("–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏");await h.fire({title:"–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ",icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"}),n()}catch(B){h.fire({title:"–û—à–∏–±–∫–∞",text:B.message||"–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏",icon:"error"})}},V=i=>{s.value=i,p.value=!0},w=i=>{y.value=i,s.value=null,p.value=!0},I=f(!1),S=f(null),N=async i=>{S.value=i,I.value=!0},L=async i=>{if(!(!S.value||!i))try{if(!(await q(`/bot-management/${d.botId}/materials/categories/${S.value.id}`,{media_id:i.id})).ok)throw new Error("–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏");I.value=!1,S.value=null,await h.fire({title:"–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ",icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"}),n()}catch(_){h.fire({title:"–û—à–∏–±–∫–∞",text:_.message||"–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–∞",icon:"error"})}},R=async i=>{try{if(!(await q(`/bot-management/${d.botId}/materials/categories/${i.id}`,{media_id:null})).ok)throw new Error("–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ñ–∞–π–ª–∞");await h.fire({title:"–§–∞–π–ª —É–¥–∞–ª–µ–Ω",icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"}),n()}catch(_){h.fire({title:"–û—à–∏–±–∫–∞",text:_.message||"–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ñ–∞–π–ª–∞",icon:"error"})}},G=()=>{p.value=!1,s.value=null,y.value=null},g=()=>{n()};return D(()=>{n()}),{loading:e,categories:u,showCategoryModal:o,showMaterialForm:p,selectedCategory:y,selectedMaterial:s,fetchCategories:n,createCategory:a,deleteCategory:M,deleteMaterial:C,editCategory:x,editMaterial:V,showMaterialModal:w,selectCategoryFile:N,showMediaPicker:I,selectedCategoryForFile:S,handleFileSelected:L,removeCategoryFile:R,handleMaterialFormClose:G,handleMaterialSaved:g}}},Ct={class:"material-category-tree space-y-4"},Mt={class:"flex items-center justify-between"},Bt={key:0,class:"text-center py-12"},It={key:1,class:"space-y-4"},St={class:"flex items-center justify-between mb-4"},Ut={class:"text-lg font-semibold"},Ft={key:0},Vt={key:0,class:"text-sm text-muted-foreground mt-1"},Tt={key:1,class:"text-xs text-muted-foreground mt-1"},Et={class:"flex gap-2"},jt=["onClick"],qt=["onClick"],Dt=["onClick"],Pt=["onClick"],zt={key:0,class:"space-y-2"},At={class:"font-medium"},Nt={key:0,class:"text-sm text-muted-foreground"},Lt={class:"text-xs text-muted-foreground"},Rt={class:"flex gap-2"},Gt=["onClick"],Ot=["onClick"],Kt={key:1,class:"text-sm text-muted-foreground p-3"},Qt=["onClick"],Ht={key:0,class:"text-center py-12 text-muted-foreground"},Jt={key:3,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4"},Wt={class:"bg-background border border-border rounded-lg shadow-2xl w-full max-w-md"},Xt={class:"p-6"},Yt={key:4,class:"fixed inset-0 z-[60] flex items-center justify-center bg-black/90 p-4"},Zt={class:"bg-background border border-border rounded-lg shadow-2xl w-full max-w-6xl max-h-[90vh] flex flex-col"},$t={class:"p-6 border-b border-border flex-shrink-0"},eo={class:"flex items-center justify-between"},to={class:"flex-1 overflow-y-auto min-h-0"};function oo(d,e,u,o,p,y){const s=E("MaterialForm"),n=E("Media");return l(),r("div",Ct,[t("div",Mt,[e[4]||(e[4]=t("h2",{class:"text-2xl font-semibold"},"–ú–∞—Ç–µ—Ä–∏–∞–ª—ã",-1)),t("button",{onClick:e[0]||(e[0]=a=>o.showCategoryModal=!0),class:"h-11 px-6 bg-accent/10 backdrop-blur-xl text-accent border border-accent/40 hover:bg-accent/20 rounded-2xl"}," + –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é ")]),o.loading?(l(),r("div",Bt,[...e[5]||(e[5]=[t("p",{class:"text-muted-foreground"},"–ó–∞–≥—Ä—É–∑–∫–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤...",-1)])])):c("",!0),o.loading?c("",!0):(l(),r("div",It,[(l(!0),r(U,null,F(o.categories,a=>(l(),r("div",{key:a.id,class:"bg-card rounded-lg border border-border p-4"},[t("div",St,[t("div",null,[t("h3",Ut,[a.icon?(l(),r("span",Ft,m(a.icon),1)):c("",!0),K(m(a.name),1)]),a.description?(l(),r("p",Vt,m(a.description),1)):c("",!0),a.media?(l(),r("p",Tt," üìé –§–∞–π–ª: "+m(a.media.name),1)):c("",!0)]),t("div",Et,[t("button",{onClick:k=>o.editCategory(a),class:"px-3 py-1 text-xs bg-green-500 hover:bg-green-600 text-white rounded"}," ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å ",8,jt),a.media_id?(l(),r("button",{key:1,onClick:k=>o.removeCategoryFile(a),class:"px-3 py-1 text-xs bg-orange-500 hover:bg-orange-600 text-white rounded"}," üóëÔ∏è –£–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª ",8,Dt)):(l(),r("button",{key:0,onClick:k=>o.selectCategoryFile(a),class:"px-3 py-1 text-xs bg-blue-500 hover:bg-blue-600 text-white rounded"}," üìé –§–∞–π–ª ",8,qt)),t("button",{onClick:k=>o.deleteCategory(a),class:"px-3 py-1 text-xs bg-red-500 hover:bg-red-600 text-white rounded"}," –£–¥–∞–ª–∏—Ç—å ",8,Pt)])]),a.materials&&a.materials.length>0?(l(),r("div",zt,[(l(!0),r(U,null,F(a.materials,k=>(l(),r("div",{key:k.id,class:"flex items-center justify-between p-3 bg-muted/30 rounded-lg"},[t("div",null,[t("p",At,m(k.title),1),k.description?(l(),r("p",Nt,m(k.description),1)):c("",!0),t("p",Lt," –°–∫–∞—á–∏–≤–∞–Ω–∏–π: "+m(k.download_count||0),1)]),t("div",Rt,[t("button",{onClick:M=>o.editMaterial(k),class:"px-3 py-1 text-xs bg-blue-500 hover:bg-blue-600 text-white rounded"}," –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å ",8,Gt),t("button",{onClick:M=>o.deleteMaterial(k),class:"px-3 py-1 text-xs bg-red-500 hover:bg-red-600 text-white rounded"}," –£–¥–∞–ª–∏—Ç—å ",8,Ot)])]))),128))])):(l(),r("div",Kt,[e[6]||(e[6]=K(" –ù–µ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ ",-1)),t("button",{onClick:k=>o.showMaterialModal(a),class:"ml-2 px-3 py-1 text-xs bg-accent/10 text-accent border border-accent/40 hover:bg-accent/20 rounded"}," + –î–æ–±–∞–≤–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª ",8,Qt)]))]))),128)),o.categories.length===0?(l(),r("div",Ht," –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é. ")):c("",!0)])),o.showMaterialForm?(l(),H(s,{key:2,"bot-id":u.botId,"category-id":o.selectedCategory?.id||o.selectedMaterial?.category_id,material:o.selectedMaterial,onClose:o.handleMaterialFormClose,onSaved:o.handleMaterialSaved},null,8,["bot-id","category-id","material","onClose","onSaved"])):c("",!0),o.showCategoryModal?(l(),r("div",Jt,[t("div",Wt,[t("div",Xt,[e[7]||(e[7]=t("h3",{class:"text-lg font-semibold mb-4"},"–°–æ–∑–¥–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é",-1)),t("button",{onClick:e[1]||(e[1]=(...a)=>o.createCategory&&o.createCategory(...a)),class:"w-full h-10 px-4 bg-accent/10 backdrop-blur-xl text-accent border border-accent/40 hover:bg-accent/20 rounded-lg"}," –û—Ç–∫—Ä—ã—Ç—å —Ñ–æ—Ä–º—É —Å–æ–∑–¥–∞–Ω–∏—è "),t("button",{onClick:e[2]||(e[2]=a=>o.showCategoryModal=!1),class:"w-full mt-2 h-10 px-4 border border-border bg-background/50 hover:bg-accent/10 rounded-lg"}," –û—Ç–º–µ–Ω–∞ ")])])])):c("",!0),o.showMediaPicker?(l(),r("div",Yt,[t("div",Zt,[t("div",$t,[t("div",eo,[e[8]||(e[8]=t("h3",{class:"text-lg font-semibold"},"–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –∏–∑ –º–µ–¥–∏–∞-–±–∏–±–ª–∏–æ—Ç–µ–∫–∏",-1)),t("button",{onClick:e[3]||(e[3]=a=>{o.showMediaPicker=!1,o.selectedCategoryForFile=null}),class:"text-muted-foreground hover:text-foreground"}," ‚úï ")])]),t("div",to,[P(n,{"selection-mode":!0,"count-file":1,"selected-files":o.selectedCategoryForFile?.media_id?[{id:o.selectedCategoryForFile.media_id}]:[],onFileSelected:o.handleFileSelected},null,8,["selected-files","onFileSelected"])])])])):c("",!0)])}const so=j(ht,[["render",oo]]),lo={name:"BotSettingsForm",props:{botId:{type:[String,Number],required:!0}},emits:["updated"],setup(d,{emit:e}){const u=f(!1),o=f(!1),p=f("main"),y=[{key:"main",label:"–û—Å–Ω–æ–≤–Ω—ã–µ"},{key:"messages",label:"–°–æ–æ–±—â–µ–Ω–∏—è"},{key:"advanced",label:"–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ"}],s=f({required_channel_id:null,required_channel_username:"",admin_telegram_ids:[],yandex_maps_url:"",welcome_message:"",other_settings:{phone_validation_strict:!1,max_description_length:1e3,subscription_check_timeout:5}}),n=async()=>{u.value=!0;try{const C=await T(`/bot-management/${d.botId}/settings`);if(!C.ok)throw new Error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫");const x=await C.json();if(x.success&&x.data){const V=x.data.settings||{},w=V.messages||{};s.value={required_channel_id:x.data.required_channel_id||null,required_channel_username:x.data.required_channel_username||"",admin_telegram_ids:x.data.admin_telegram_ids||[],yandex_maps_url:x.data.yandex_maps_url||"",welcome_message:x.data.welcome_message||"",messages:{subscription:w.subscription||{required_text:"",subscribe_button:"",check_button:""},consultation:w.consultation||{description:"",form_name_label:"",form_phone_label:"",form_description_label:"",thank_you:"",start_button:"",skip_description_button:""},materials:w.materials||{list_description:"",download_button:"",back_to_list:""},menu:w.menu||{materials_button:"",consultation_button:"",review_button:"",back_to_menu:""},notifications:w.notifications||{consultation_template:""}},other_settings:V.other_settings||{phone_validation_strict:!1,max_description_length:1e3,subscription_check_timeout:5}}}}catch(C){console.error("Error fetching settings:",C)}finally{u.value=!1}},a=async()=>{o.value=!0;try{const C=await q(`/bot-management/${d.botId}/settings`,{required_channel_id:s.value.required_channel_id,required_channel_username:s.value.required_channel_username,admin_telegram_ids:s.value.admin_telegram_ids,yandex_maps_url:s.value.yandex_maps_url,welcome_message:s.value.welcome_message,settings:{messages:s.value.messages,other_settings:s.value.other_settings}});if(!C.ok){const x=await C.json().catch(()=>({}));throw new Error(x.message||"–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫")}await h.fire({title:"–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ",icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"}),e("updated")}catch(C){h.fire({title:"–û—à–∏–±–∫–∞",text:C.message||"–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫",icon:"error",confirmButtonText:"–û–ö"})}finally{o.value=!1}},k=()=>{s.value.admin_telegram_ids.push(null)},M=C=>{s.value.admin_telegram_ids.splice(C,1)};return D(()=>{n()}),{loading:u,saving:o,activeTab:p,tabs:y,form:s,fetchSettings:n,saveSettings:a,addAdmin:k,removeAdmin:M}}},ro={class:"bot-settings-form space-y-6"},no={class:"border-b border-border"},ao={class:"flex -mb-px"},io=["onClick"],uo={key:0,class:"bg-card rounded-lg border border-border p-6 space-y-4"},mo={class:"space-y-2"},bo=["onUpdate:modelValue"],co=["onClick"],fo={key:1,class:"bg-card rounded-lg border border-border p-6 space-y-6"},go={class:"space-y-4"},xo={class:"space-y-4 pt-4 border-t border-border"},vo={class:"space-y-4 pt-4 border-t border-border"},po={class:"space-y-4 pt-4 border-t border-border"},_o={class:"space-y-4 pt-4 border-t border-border"},yo={key:2,class:"bg-card rounded-lg border border-border p-6 space-y-4"},ko={class:"flex items-center gap-2"},wo={class:"flex gap-4"},ho=["disabled"];function Co(d,e,u,o,p,y){return l(),r("div",ro,[e[64]||(e[64]=t("h2",{class:"text-2xl font-semibold"},"–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞",-1)),t("div",no,[t("nav",ao,[(l(!0),r(U,null,F(o.tabs,s=>(l(),r("button",{key:s.key,onClick:n=>o.activeTab=s.key,class:A(["px-6 py-4 text-sm font-medium border-b-2 transition-colors",o.activeTab===s.key?"border-accent text-accent":"border-transparent text-muted-foreground hover:text-foreground hover:border-muted-foreground"])},m(s.label),11,io))),128))])]),t("form",{onSubmit:e[26]||(e[26]=J((...s)=>o.saveSettings&&o.saveSettings(...s),["prevent"])),class:"space-y-6"},[o.activeTab==="main"?(l(),r("div",uo,[e[34]||(e[34]=t("h3",{class:"text-lg font-semibold"},"–û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏",-1)),t("div",null,[e[27]||(e[27]=t("label",{class:"block text-sm font-medium mb-2"},"ID –∫–∞–Ω–∞–ª–∞",-1)),b(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>o.form.required_channel_id=s),type:"number",placeholder:"-1001234567890",class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},null,512),[[v,o.form.required_channel_id,void 0,{number:!0}]]),e[28]||(e[28]=t("p",{class:"text-xs text-muted-foreground mt-1"}," ID –∫–∞–Ω–∞–ª–∞ (–º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —á–µ—Ä–µ–∑ –±–æ—Ç–∞ @userinfobot) ",-1))]),t("div",null,[e[29]||(e[29]=t("label",{class:"block text-sm font-medium mb-2"},"Username –∫–∞–Ω–∞–ª–∞",-1)),b(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>o.form.required_channel_username=s),type:"text",placeholder:"aip_channel",class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},null,512),[[v,o.form.required_channel_username]]),e[30]||(e[30]=t("p",{class:"text-xs text-muted-foreground mt-1"}," Username –∫–∞–Ω–∞–ª–∞ –±–µ–∑ —Å–∏–º–≤–æ–ª–∞ @ ",-1))]),t("div",null,[e[31]||(e[31]=t("label",{class:"block text-sm font-medium mb-2"},"Telegram ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤",-1)),t("div",mo,[(l(!0),r(U,null,F(o.form.admin_telegram_ids,(s,n)=>(l(),r("div",{key:n,class:"flex gap-2"},[b(t("input",{"onUpdate:modelValue":a=>o.form.admin_telegram_ids[n]=a,type:"number",placeholder:"123456789",class:"flex-1 h-10 px-3 border border-border rounded-lg bg-background"},null,8,bo),[[v,o.form.admin_telegram_ids[n],void 0,{number:!0}]]),t("button",{type:"button",onClick:a=>o.removeAdmin(n),class:"px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg"}," –£–¥–∞–ª–∏—Ç—å ",8,co)]))),128)),t("button",{type:"button",onClick:e[2]||(e[2]=(...s)=>o.addAdmin&&o.addAdmin(...s)),class:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg"}," + –î–æ–±–∞–≤–∏—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ ")])]),t("div",null,[e[32]||(e[32]=t("label",{class:"block text-sm font-medium mb-2"},"–°—Å—ã–ª–∫–∞ –Ω–∞ –Ø–Ω–¥–µ–∫—Å –ö–∞—Ä—Ç—ã",-1)),b(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>o.form.yandex_maps_url=s),type:"url",placeholder:"https://yandex.ru/maps/org/...",class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},null,512),[[v,o.form.yandex_maps_url]])]),t("div",null,[e[33]||(e[33]=t("label",{class:"block text-sm font-medium mb-2"},"–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ",-1)),b(t("textarea",{"onUpdate:modelValue":e[4]||(e[4]=s=>o.form.welcome_message=s),rows:"6",placeholder:"–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å...",class:"w-full px-3 py-2 border border-border rounded-lg bg-background resize-none"},null,512),[[v,o.form.welcome_message]])])])):c("",!0),o.activeTab==="messages"?(l(),r("div",fo,[e[59]||(e[59]=t("h3",{class:"text-lg font-semibold"},"–¢–µ–∫—Å—Ç—ã —Å–æ–æ–±—â–µ–Ω–∏–π –±–æ—Ç–∞",-1)),t("div",go,[e[38]||(e[38]=t("h4",{class:"text-md font-medium"},"–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∫–∞–Ω–∞–ª",-1)),t("div",null,[e[35]||(e[35]=t("label",{class:"block text-sm font-medium mb-2"},"–¢–µ–∫—Å—Ç —ç–∫—Ä–∞–Ω–∞ –ø–æ–¥–ø–∏—Å–∫–∏",-1)),b(t("textarea",{"onUpdate:modelValue":e[5]||(e[5]=s=>o.form.messages.subscription.required_text=s),rows:"3",placeholder:"–î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –±–µ—Ç–∞-–≤–µ—Ä—Å–∏–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è...",class:"w-full px-3 py-2 border border-border rounded-lg bg-background resize-none"},null,512),[[v,o.form.messages.subscription.required_text]])]),t("div",null,[e[36]||(e[36]=t("label",{class:"block text-sm font-medium mb-2"},"–¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏",-1)),b(t("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>o.form.messages.subscription.subscribe_button=s),type:"text",placeholder:"üîî –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ Telegram",class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},null,512),[[v,o.form.messages.subscription.subscribe_button]])]),t("div",null,[e[37]||(e[37]=t("label",{class:"block text-sm font-medium mb-2"},"–¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏",-1)),b(t("input",{"onUpdate:modelValue":e[7]||(e[7]=s=>o.form.messages.subscription.check_button=s),type:"text",placeholder:"‚úÖ –Ø –ø–æ–¥–ø–∏—Å–∞–ª—Å—è",class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},null,512),[[v,o.form.messages.subscription.check_button]])])]),t("div",xo,[e[46]||(e[46]=t("h4",{class:"text-md font-medium"},"–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è",-1)),t("div",null,[e[39]||(e[39]=t("label",{class:"block text-sm font-medium mb-2"},"–û–ø–∏—Å–∞–Ω–∏–µ —É—Å–ª—É–≥–∏",-1)),b(t("textarea",{"onUpdate:modelValue":e[8]||(e[8]=s=>o.form.messages.consultation.description=s),rows:"4",placeholder:"–ï—Å–ª–∏ –≤–∞—à–µ–º—É –±–∏–∑–Ω–µ—Å—É –Ω—É–∂–Ω–∞ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è...",class:"w-full px-3 py-2 border border-border rounded-lg bg-background resize-none"},null,512),[[v,o.form.messages.consultation.description]])]),t("div",null,[e[40]||(e[40]=t("label",{class:"block text-sm font-medium mb-2"},'–¢–µ–∫—Å—Ç –ø–æ–ª—è "–ò–º—è"',-1)),b(t("input",{"onUpdate:modelValue":e[9]||(e[9]=s=>o.form.messages.consultation.form_name_label=s),type:"text",placeholder:"–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è:",class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},null,512),[[v,o.form.messages.consultation.form_name_label]])]),t("div",null,[e[41]||(e[41]=t("label",{class:"block text-sm font-medium mb-2"},'–¢–µ–∫—Å—Ç –ø–æ–ª—è "–¢–µ–ª–µ—Ñ–æ–Ω"',-1)),b(t("input",{"onUpdate:modelValue":e[10]||(e[10]=s=>o.form.messages.consultation.form_phone_label=s),type:"text",placeholder:"–í–≤–µ–¥–∏—Ç–µ –≤–∞—à —Ç–µ–ª–µ—Ñ–æ–Ω:",class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},null,512),[[v,o.form.messages.consultation.form_phone_label]])]),t("div",null,[e[42]||(e[42]=t("label",{class:"block text-sm font-medium mb-2"},'–¢–µ–∫—Å—Ç –ø–æ–ª—è "–û–ø–∏—Å–∞–Ω–∏–µ"',-1)),b(t("input",{"onUpdate:modelValue":e[11]||(e[11]=s=>o.form.messages.consultation.form_description_label=s),type:"text",placeholder:"–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ...):",class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},null,512),[[v,o.form.messages.consultation.form_description_label]])]),t("div",null,[e[43]||(e[43]=t("label",{class:"block text-sm font-medium mb-2"},"–°–æ–æ–±—â–µ–Ω–∏–µ –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏",-1)),b(t("textarea",{"onUpdate:modelValue":e[12]||(e[12]=s=>o.form.messages.consultation.thank_you=s),rows:"2",placeholder:"–°–ø–∞—Å–∏–±–æ. –ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è.",class:"w-full px-3 py-2 border border-border rounded-lg bg-background resize-none"},null,512),[[v,o.form.messages.consultation.thank_you]])]),t("div",null,[e[44]||(e[44]=t("label",{class:"block text-sm font-medium mb-2"},'–¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ "–ó–∞–ø–∏—Å–∞—Ç—å—Å—è"',-1)),b(t("input",{"onUpdate:modelValue":e[13]||(e[13]=s=>o.form.messages.consultation.start_button=s),type:"text",placeholder:"üìù –ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é",class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},null,512),[[v,o.form.messages.consultation.start_button]])]),t("div",null,[e[45]||(e[45]=t("label",{class:"block text-sm font-medium mb-2"},'–¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ "–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å"',-1)),b(t("input",{"onUpdate:modelValue":e[14]||(e[14]=s=>o.form.messages.consultation.skip_description_button=s),type:"text",placeholder:"–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å",class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},null,512),[[v,o.form.messages.consultation.skip_description_button]])])]),t("div",vo,[e[50]||(e[50]=t("h4",{class:"text-md font-medium"},"–ú–∞—Ç–µ—Ä–∏–∞–ª—ã",-1)),t("div",null,[e[47]||(e[47]=t("label",{class:"block text-sm font-medium mb-2"},"–û–ø–∏—Å–∞–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤",-1)),b(t("textarea",{"onUpdate:modelValue":e[15]||(e[15]=s=>o.form.messages.materials.list_description=s),rows:"3",placeholder:"–ú—ã –ø–æ–¥–≥–æ—Ç–æ–≤–∏–ª–∏ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –ø–æ –∫–ª—é—á–µ–≤—ã–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º...",class:"w-full px-3 py-2 border border-border rounded-lg bg-background resize-none"},null,512),[[v,o.form.messages.materials.list_description]])]),t("div",null,[e[48]||(e[48]=t("label",{class:"block text-sm font-medium mb-2"},"–¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è",-1)),b(t("input",{"onUpdate:modelValue":e[16]||(e[16]=s=>o.form.messages.materials.download_button=s),type:"text",placeholder:"‚¨áÔ∏è –°–∫–∞—á–∞—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª—ã",class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},null,512),[[v,o.form.messages.materials.download_button]])]),t("div",null,[e[49]||(e[49]=t("label",{class:"block text-sm font-medium mb-2"},'–¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥"',-1)),b(t("input",{"onUpdate:modelValue":e[17]||(e[17]=s=>o.form.messages.materials.back_to_list=s),type:"text",placeholder:"‚¨ÖÔ∏è –ù–∞–∑–∞–¥",class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},null,512),[[v,o.form.messages.materials.back_to_list]])])]),t("div",po,[e[55]||(e[55]=t("h4",{class:"text-md font-medium"},"–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é",-1)),t("div",null,[e[51]||(e[51]=t("label",{class:"block text-sm font-medium mb-2"},'–¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ "–ú–∞—Ç–µ—Ä–∏–∞–ª—ã"',-1)),b(t("input",{"onUpdate:modelValue":e[18]||(e[18]=s=>o.form.messages.menu.materials_button=s),type:"text",placeholder:"üìÇ –ü–æ–ª–µ–∑–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –∏ –¥–æ–≥–æ–≤–æ—Ä—ã",class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},null,512),[[v,o.form.messages.menu.materials_button]])]),t("div",null,[e[52]||(e[52]=t("label",{class:"block text-sm font-medium mb-2"},'–¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ "–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è"',-1)),b(t("input",{"onUpdate:modelValue":e[19]||(e[19]=s=>o.form.messages.menu.consultation_button=s),type:"text",placeholder:"üìû –ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é",class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},null,512),[[v,o.form.messages.menu.consultation_button]])]),t("div",null,[e[53]||(e[53]=t("label",{class:"block text-sm font-medium mb-2"},'–¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ "–û—Ç–∑—ã–≤"',-1)),b(t("input",{"onUpdate:modelValue":e[20]||(e[20]=s=>o.form.messages.menu.review_button=s),type:"text",placeholder:"‚≠ê –û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤ –Ω–∞ –Ø–Ω–¥–µ–∫—Å –ö–∞—Ä—Ç–∞—Ö",class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},null,512),[[v,o.form.messages.menu.review_button]])]),t("div",null,[e[54]||(e[54]=t("label",{class:"block text-sm font-medium mb-2"},'–¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é"',-1)),b(t("input",{"onUpdate:modelValue":e[21]||(e[21]=s=>o.form.messages.menu.back_to_menu=s),type:"text",placeholder:"‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é",class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},null,512),[[v,o.form.messages.menu.back_to_menu]])])]),t("div",_o,[e[58]||(e[58]=t("h4",{class:"text-md font-medium"},"–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º",-1)),t("div",null,[e[56]||(e[56]=t("label",{class:"block text-sm font-medium mb-2"},"–®–∞–±–ª–æ–Ω —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤–æ–π –∑–∞—è–≤–∫–µ",-1)),b(t("textarea",{"onUpdate:modelValue":e[22]||(e[22]=s=>o.form.messages.notifications.consultation_template=s),rows:"6",placeholder:`–ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞ –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é

–ò–º—è: {name}
–¢–µ–ª–µ—Ñ–æ–Ω: {phone}
–û–ø–∏—Å–∞–Ω–∏–µ: {description}
–î–∞—Ç–∞: {date}`,class:"w-full px-3 py-2 border border-border rounded-lg bg-background resize-none font-mono text-sm"},null,512),[[v,o.form.messages.notifications.consultation_template]]),e[57]||(e[57]=t("p",{class:"text-xs text-muted-foreground mt-1"}," –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ: {name}, {phone}, {description}, {date} ",-1))])])])):c("",!0),o.activeTab==="advanced"?(l(),r("div",yo,[e[63]||(e[63]=t("h3",{class:"text-lg font-semibold"},"–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏",-1)),t("div",null,[t("label",ko,[b(t("input",{"onUpdate:modelValue":e[23]||(e[23]=s=>o.form.other_settings.phone_validation_strict=s),type:"checkbox",class:"w-4 h-4"},null,512),[[W,o.form.other_settings.phone_validation_strict]]),e[60]||(e[60]=t("span",null,"–°—Ç—Ä–æ–≥–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞",-1))])]),t("div",null,[e[61]||(e[61]=t("label",{class:"block text-sm font-medium mb-2"},"–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –æ–ø–∏—Å–∞–Ω–∏—è",-1)),b(t("input",{"onUpdate:modelValue":e[24]||(e[24]=s=>o.form.other_settings.max_description_length=s),type:"number",min:"10",max:"5000",class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},null,512),[[v,o.form.other_settings.max_description_length,void 0,{number:!0}]])]),t("div",null,[e[62]||(e[62]=t("label",{class:"block text-sm font-medium mb-2"},"–¢–∞–π–º–∞—É—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏ (—Å–µ–∫)",-1)),b(t("input",{"onUpdate:modelValue":e[25]||(e[25]=s=>o.form.other_settings.subscription_check_timeout=s),type:"number",min:"1",max:"30",class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},null,512),[[v,o.form.other_settings.subscription_check_timeout,void 0,{number:!0}]])])])):c("",!0),t("div",wo,[t("button",{type:"submit",disabled:o.saving,class:"flex-1 h-11 px-6 bg-accent/10 backdrop-blur-xl text-accent border border-accent/40 hover:bg-accent/20 rounded-2xl disabled:opacity-50"},m(o.saving?"–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...":"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏"),9,ho)])],32)])}const Mo=j(lo,[["render",Co]]),Bo={name:"BotStatistics",props:{botId:{type:[String,Number],required:!0}},setup(d){const e=f(!1),u=f(null),o=async()=>{e.value=!0;try{const p=await T(`/bot-management/${d.botId}/statistics`);if(!p.ok)throw new Error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏");const y=await p.json();y.success&&y.data&&(u.value=y.data)}catch(p){console.error("Error fetching statistics:",p)}finally{e.value=!1}};return D(()=>{o()}),{loading:e,statistics:u}}},Io={class:"bot-statistics space-y-6"},So={key:0,class:"text-center py-12"},Uo={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},Fo={class:"bg-card rounded-lg border border-border p-6"},Vo={class:"text-3xl font-semibold"},To={class:"bg-card rounded-lg border border-border p-6"},Eo={class:"text-3xl font-semibold"},jo={class:"bg-card rounded-lg border border-border p-6"},qo={class:"text-3xl font-semibold"},Do={class:"bg-card rounded-lg border border-border p-6"},Po={class:"text-3xl font-semibold"},zo={key:2,class:"bg-card rounded-lg border border-border p-6"},Ao={class:"grid grid-cols-3 gap-4"},No={class:"text-2xl font-semibold"},Lo={class:"text-2xl font-semibold"},Ro={class:"text-2xl font-semibold"},Go={key:3,class:"bg-card rounded-lg border border-border p-6"},Oo={class:"space-y-2"},Ko={class:"font-medium"},Qo={class:"text-sm text-muted-foreground"};function Ho(d,e,u,o,p,y){return l(),r("div",Io,[e[10]||(e[10]=t("h2",{class:"text-2xl font-semibold"},"–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞",-1)),o.loading?(l(),r("div",So,[...e[0]||(e[0]=[t("p",{class:"text-muted-foreground"},"–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...",-1)])])):c("",!0),!o.loading&&o.statistics?(l(),r("div",Uo,[t("div",Fo,[e[1]||(e[1]=t("h3",{class:"text-sm font-medium text-muted-foreground mb-2"},"–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π",-1)),t("p",Vo,m(o.statistics.total_users||0),1)]),t("div",To,[e[2]||(e[2]=t("h3",{class:"text-sm font-medium text-muted-foreground mb-2"},"–ê–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞ 30 –¥–Ω–µ–π",-1)),t("p",Eo,m(o.statistics.active_users_30d||0),1)]),t("div",jo,[e[3]||(e[3]=t("h3",{class:"text-sm font-medium text-muted-foreground mb-2"},"–í—Å–µ–≥–æ –∑–∞—è–≤–æ–∫",-1)),t("p",qo,m(o.statistics.total_consultations||0),1)]),t("div",Do,[e[4]||(e[4]=t("h3",{class:"text-sm font-medium text-muted-foreground mb-2"},"–°–∫–∞—á–∏–≤–∞–Ω–∏–π –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤",-1)),t("p",Po,m(o.statistics.materials_downloads||0),1)])])):c("",!0),!o.loading&&o.statistics?(l(),r("div",zo,[e[8]||(e[8]=t("h3",{class:"text-lg font-semibold mb-4"},"–ó–∞—è–≤–∫–∏ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º",-1)),t("div",Ao,[t("div",null,[e[5]||(e[5]=t("p",{class:"text-sm text-muted-foreground"},"–ù–æ–≤—ã–µ",-1)),t("p",No,m(o.statistics.consultations_by_status?.new||0),1)]),t("div",null,[e[6]||(e[6]=t("p",{class:"text-sm text-muted-foreground"},"–í —Ä–∞–±–æ—Ç–µ",-1)),t("p",Lo,m(o.statistics.consultations_by_status?.in_progress||0),1)]),t("div",null,[e[7]||(e[7]=t("p",{class:"text-sm text-muted-foreground"},"–ó–∞–∫—Ä—ã—Ç—ã–µ",-1)),t("p",Ro,m(o.statistics.consultations_by_status?.closed||0),1)])])])):c("",!0),!o.loading&&o.statistics&&o.statistics.popular_materials?.length>0?(l(),r("div",Go,[e[9]||(e[9]=t("h3",{class:"text-lg font-semibold mb-4"},"–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã",-1)),t("div",Oo,[(l(!0),r(U,null,F(o.statistics.popular_materials,s=>(l(),r("div",{key:s.id,class:"flex items-center justify-between p-3 bg-muted/30 rounded-lg"},[t("p",Ko,m(s.title),1),t("p",Qo,m(s.download_count||0)+" —Å–∫–∞—á–∏–≤–∞–Ω–∏–π",1)]))),128))])])):c("",!0)])}const Jo=j(Bo,[["render",Ho]]),Wo={name:"BotManagement",components:{ConsultationTable:Ke,MaterialCategoryTree:so,BotSettingsForm:Mo,BotStatistics:Jo},setup(){const d=Z(),e=Y(()=>d.params.botId),u=f(!1),o=f(null),p=f(null),y=f("consultations"),s=[{key:"consultations",label:"–ó–∞—è–≤–∫–∏"},{key:"materials",label:"–ú–∞—Ç–µ—Ä–∏–∞–ª—ã"},{key:"settings",label:"–ù–∞—Å—Ç—Ä–æ–π–∫–∏"},{key:"statistics",label:"–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞"}],n=async()=>{u.value=!0,o.value=null;try{const a=await T(`/bots/${e.value}`);if(!a.ok){const M=await a.json().catch(()=>({}));throw new Error(M.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–æ—Ç–∞")}const k=await a.json();p.value=k.data||null}catch(a){o.value=a.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–æ—Ç–∞"}finally{u.value=!1}};return D(()=>{n()}),{botId:e,loading:u,error:o,bot:p,activeTab:y,tabs:s,fetchBot:n}}},Xo={class:"bot-management-page space-y-6"},Yo={class:"flex items-center justify-between"},Zo={key:0,class:"text-muted-foreground mt-1"},$o={key:0,class:"flex items-center justify-center py-12"},es={key:1,class:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg"},ts={class:"text-destructive"},os={key:2,class:"bg-card rounded-lg border border-border"},ss={class:"border-b border-border"},ls={class:"flex -mb-px"},rs=["onClick"],ns={class:"p-6"},ds={key:0},as={key:1},is={key:2},us={key:3};function ms(d,e,u,o,p,y){const s=E("ConsultationTable"),n=E("MaterialCategoryTree"),a=E("BotSettingsForm"),k=E("BotStatistics");return l(),r("div",Xo,[t("div",Yo,[t("div",null,[e[1]||(e[1]=t("h1",{class:"text-3xl font-semibold text-foreground"},"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–æ—Ç–æ–º",-1)),o.bot?(l(),r("p",Zo,m(o.bot.name),1)):c("",!0)]),t("button",{onClick:e[0]||(e[0]=M=>d.$router.push({name:"admin.bots"})),class:"h-11 px-6 bg-accent/10 backdrop-blur-xl text-accent border border-accent/40 hover:bg-accent/20 rounded-2xl shadow-lg shadow-accent/10 inline-flex items-center justify-center gap-2"}," ‚Üê –ù–∞–∑–∞–¥ –∫ –±–æ—Ç–∞–º ")]),o.loading?(l(),r("div",$o,[...e[2]||(e[2]=[t("p",{class:"text-muted-foreground"},"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...",-1)])])):c("",!0),o.error?(l(),r("div",es,[t("p",ts,m(o.error),1)])):c("",!0),!o.loading&&o.bot?(l(),r("div",os,[t("div",ss,[t("nav",ls,[(l(!0),r(U,null,F(o.tabs,M=>(l(),r("button",{key:M.key,onClick:C=>o.activeTab=M.key,class:A(["px-6 py-4 text-sm font-medium border-b-2 transition-colors",o.activeTab===M.key?"border-accent text-accent":"border-transparent text-muted-foreground hover:text-foreground hover:border-muted-foreground"])},m(M.label),11,rs))),128))])]),t("div",ns,[o.activeTab==="consultations"?(l(),r("div",ds,[P(s,{"bot-id":o.botId},null,8,["bot-id"])])):c("",!0),o.activeTab==="materials"?(l(),r("div",as,[P(n,{"bot-id":o.botId},null,8,["bot-id"])])):c("",!0),o.activeTab==="settings"?(l(),r("div",is,[P(a,{"bot-id":o.botId,onUpdated:o.fetchBot},null,8,["bot-id","onUpdated"])])):c("",!0),o.activeTab==="statistics"?(l(),r("div",us,[P(k,{"bot-id":o.botId},null,8,["bot-id"])])):c("",!0)])])):c("",!0)])}const xs=j(Wo,[["render",ms]]);export{xs as default};
