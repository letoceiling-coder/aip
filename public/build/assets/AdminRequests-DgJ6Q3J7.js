import{_ as M,c as n,a as t,b as c,d as b,C as _,F as h,q as y,t as d,r as f,k as S,o as r,p as I,e as T}from"./admin-DxgQoy7P.js";import{a as k,c as B}from"./api-DccBIR6h.js";import{S as u}from"./sweetalert2.esm.all-C0u8rGqG.js";const U={name:"AdminRequests",setup(){const g=f(!1),s=f(null),v=f([]),o=f([]),m=f({status:"",bot_id:""}),x=async()=>{try{const a=await k("/bots");if(a.ok){const i=await a.json();o.value=i.data||[]}}catch(a){console.error("Error fetching bots:",a)}},e=async()=>{g.value=!0,s.value=null;try{const a=new URLSearchParams;m.value.status&&a.append("status",m.value.status),m.value.bot_id&&a.append("bot_id",m.value.bot_id);const i=await k(`/admin-requests?${a.toString()}`);if(!i.ok)throw new Error("Ошибка загрузки заявок");const l=await i.json();v.value=l.data?.requests||[]}catch(a){s.value=a.message||"Ошибка загрузки заявок"}finally{g.value=!1}},w=async a=>{const{value:i}=await u.fire({title:"Одобрить заявку",html:`
                    <input id="swal-email" class="swal2-input" placeholder="Email *" required>
                    <input id="swal-name" class="swal2-input" placeholder="Имя (необязательно)">
                    <input id="swal-password" class="swal2-input" type="password" placeholder="Пароль (необязательно, будет сгенерирован)">
                    <textarea id="swal-notes" class="swal2-textarea" placeholder="Примечание (необязательно)"></textarea>
                `,focusConfirm:!1,showCancelButton:!0,confirmButtonText:"Одобрить",cancelButtonText:"Отмена",preConfirm:()=>{const l=document.getElementById("swal-email").value,p=document.getElementById("swal-name").value,D=document.getElementById("swal-password").value,V=document.getElementById("swal-notes").value;return l?{email:l,name:p||null,password:D||null,admin_notes:V||null}:(u.showValidationMessage("Email обязателен"),!1)}});i&&await R(a.id,i)},C=async a=>{const{value:i}=await u.fire({title:"Отклонить заявку",html:`
                    <textarea id="swal-notes" class="swal2-textarea" placeholder="Причина отклонения (необязательно)"></textarea>
                `,focusConfirm:!1,showCancelButton:!0,confirmButtonText:"Отклонить",cancelButtonText:"Отмена",preConfirm:()=>({admin_notes:document.getElementById("swal-notes").value||null})});i&&await j(a.id,i)},R=async(a,i)=>{try{const l=await B(`/admin-requests/${a}/approve`,i);if(!l.ok){const p=await l.json().catch(()=>({}));throw new Error(p.message||"Ошибка одобрения заявки")}await u.fire({title:"Успешно",text:"Заявка одобрена, пользователю назначена роль администратора",icon:"success"}),e()}catch(l){u.fire({title:"Ошибка",text:l.message||"Ошибка одобрения заявки",icon:"error"})}},j=async(a,i)=>{try{const l=await B(`/admin-requests/${a}/reject`,i);if(!l.ok){const p=await l.json().catch(()=>({}));throw new Error(p.message||"Ошибка отклонения заявки")}await u.fire({title:"Успешно",text:"Заявка отклонена",icon:"success"}),e()}catch(l){u.fire({title:"Ошибка",text:l.message||"Ошибка отклонения заявки",icon:"error"})}},E=a=>a?new Date(a).toLocaleString("ru-RU"):"";return S(()=>{x(),e()}),{loading:g,error:s,requests:v,bots:o,filters:m,fetchRequests:e,showApproveModal:w,showRejectModal:C,formatDate:E}}},A={class:"admin-requests-page space-y-6"},L={class:"bg-card rounded-lg border border-border p-4"},N={class:"flex gap-4 items-end"},F={class:"flex-1"},P={class:"flex-1"},z=["value"],G={key:0,class:"flex items-center justify-center py-12"},H={key:1,class:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg"},J={class:"text-destructive"},K={key:2,class:"bg-card rounded-lg border border-border overflow-hidden"},O={key:0,class:"text-center py-12 text-muted-foreground"},Q={key:1,class:"divide-y divide-border"},W={class:"flex items-start justify-between"},X={class:"flex-1"},Y={class:"flex items-center gap-3 mb-2"},Z={class:"text-lg font-semibold"},q={class:"space-y-1 text-sm text-muted-foreground"},$={key:0},ee={key:1},te={key:2},se={key:3},oe={key:4,class:"mt-2 text-foreground"},ae={key:0,class:"flex gap-2 ml-4"},ne=["onClick"],re=["onClick"];function le(g,s,v,o,m,x){return r(),n("div",A,[s[10]||(s[10]=t("div",{class:"flex items-center justify-between"},[t("div",null,[t("h1",{class:"text-3xl font-semibold text-foreground"},"Заявки на администратора"),t("p",{class:"text-muted-foreground mt-1"},"Управление заявками на назначение администратором")])],-1)),t("div",L,[t("div",N,[t("div",F,[s[5]||(s[5]=t("label",{class:"block text-sm font-medium mb-2"},"Статус",-1)),b(t("select",{"onUpdate:modelValue":s[0]||(s[0]=e=>o.filters.status=e),onChange:s[1]||(s[1]=(...e)=>o.fetchRequests&&o.fetchRequests(...e)),class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},[...s[4]||(s[4]=[t("option",{value:""},"Все",-1),t("option",{value:"pending"},"Ожидают",-1),t("option",{value:"approved"},"Одобрены",-1),t("option",{value:"rejected"},"Отклонены",-1)])],544),[[_,o.filters.status]])]),t("div",P,[s[7]||(s[7]=t("label",{class:"block text-sm font-medium mb-2"},"Бот",-1)),b(t("select",{"onUpdate:modelValue":s[2]||(s[2]=e=>o.filters.bot_id=e),onChange:s[3]||(s[3]=(...e)=>o.fetchRequests&&o.fetchRequests(...e)),class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},[s[6]||(s[6]=t("option",{value:""},"Все боты",-1)),(r(!0),n(h,null,y(o.bots,e=>(r(),n("option",{key:e.id,value:e.id},d(e.name),9,z))),128))],544),[[_,o.filters.bot_id]])])])]),o.loading?(r(),n("div",G,[...s[8]||(s[8]=[t("p",{class:"text-muted-foreground"},"Загрузка заявок...",-1)])])):c("",!0),o.error?(r(),n("div",H,[t("p",J,d(o.error),1)])):c("",!0),!o.loading&&!o.error?(r(),n("div",K,[o.requests.length===0?(r(),n("div",O," Заявки не найдены ")):(r(),n("div",Q,[(r(!0),n(h,null,y(o.requests,e=>(r(),n("div",{key:e.id,class:"p-6 hover:bg-muted/10 transition-colors"},[t("div",W,[t("div",X,[t("div",Y,[t("h3",Z,d(e.full_name),1),t("span",{class:I(["px-2 py-1 text-xs rounded",e.status==="pending"?"bg-yellow-500/10 text-yellow-600":e.status==="approved"?"bg-green-500/10 text-green-600":"bg-red-500/10 text-red-600"])},d(e.status==="pending"?"Ожидает":e.status==="approved"?"Одобрена":"Отклонена"),3)]),t("div",q,[t("p",null,"Telegram ID: "+d(e.telegram_user_id),1),e.username?(r(),n("p",$,"Username: @"+d(e.username),1)):c("",!0),e.bot?(r(),n("p",ee,"Бот: "+d(e.bot.name),1)):c("",!0),t("p",null,"Создана: "+d(o.formatDate(e.created_at)),1),e.approved_at?(r(),n("p",te,"Обработана: "+d(o.formatDate(e.approved_at)),1)):c("",!0),e.approver?(r(),n("p",se,"Обработал: "+d(e.approver.name),1)):c("",!0),e.admin_notes?(r(),n("p",oe,[s[9]||(s[9]=t("strong",null,"Примечание:",-1)),T(" "+d(e.admin_notes),1)])):c("",!0)])]),e.status==="pending"?(r(),n("div",ae,[t("button",{onClick:w=>o.showApproveModal(e),class:"px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg text-sm"}," Одобрить ",8,ne),t("button",{onClick:w=>o.showRejectModal(e),class:"px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg text-sm"}," Отклонить ",8,re)])):c("",!0)])]))),128))]))])):c("",!0)])}const ue=M(U,[["render",le]]);export{ue as default};
