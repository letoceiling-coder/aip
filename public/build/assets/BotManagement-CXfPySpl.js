import{_ as I,r as g,c as l,a as t,t as a,b as u,d as v,I as q,v as w,o as r,n as P,k as M,x as F,F as C,q as S,h as D,p as V,N,w as A,f as U,m as L,l as z}from"./admin-B7Ob3Dpt.js";import{a as E,c as B,d as $}from"./api-BACpyIk9.js";import{S as p}from"./sweetalert2.esm.all-C0u8rGqG.js";const R={name:"ConsultationDetail",props:{consultation:{type:Object,required:!0},botId:{type:[String,Number],required:!0}},emits:["close","updated"],setup(c,{emit:e}){const d=g(!1),o=g({status:c.consultation.status,admin_notes:c.consultation.admin_notes||""});return{form:o,saving:d,saveConsultation:async()=>{d.value=!0;try{const s=await E(`/bot-management/${c.botId}/consultations/${c.consultation.id}`,o.value);if(!s.ok){const n=await s.json().catch(()=>({}));throw new Error(n.message||"Ошибка сохранения")}await p.fire({title:"Сохранено",icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"}),e("updated"),e("close")}catch(s){p.fire({title:"Ошибка",text:s.message||"Ошибка сохранения",icon:"error",confirmButtonText:"ОК"})}finally{d.value=!1}},formatDate:s=>new Date(s).toLocaleString("ru-RU")}}},G={class:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4"},O={class:"bg-background border border-border rounded-lg shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto"},H={class:"sticky top-0 bg-background border-b border-border p-6"},J={class:"flex items-center justify-between"},K={class:"text-lg font-semibold"},Q={class:"p-6 space-y-6"},W={key:0},X={class:"bg-muted/30 rounded-lg p-4"},Y={class:"text-sm"},Z={key:0,class:"text-sm"},tt={key:1,class:"text-sm"},et={class:"space-y-3"},ot={class:"text-sm"},st={class:"text-sm"},nt={key:0},rt={class:"text-sm whitespace-pre-wrap"},lt={class:"text-sm"},dt={class:"flex gap-2 pt-4 border-t border-border"},at=["disabled"];function it(c,e,d,o,i,f){return r(),l("div",G,[t("div",O,[t("div",H,[t("div",J,[t("h3",K,"Детали заявки #"+a(d.consultation.id),1),t("button",{onClick:e[0]||(e[0]=s=>c.$emit("close")),class:"text-muted-foreground hover:text-foreground"}," ✕ ")])]),t("div",Q,[d.consultation.user?(r(),l("div",W,[e[5]||(e[5]=t("h4",{class:"text-sm font-medium text-muted-foreground mb-2"},"Пользователь",-1)),t("div",X,[t("p",Y,"ID: "+a(d.consultation.user.telegram_user_id),1),d.consultation.user.username?(r(),l("p",Z,"@"+a(d.consultation.user.username),1)):u("",!0),d.consultation.user.first_name?(r(),l("p",tt,a(d.consultation.user.first_name)+" "+a(d.consultation.user.last_name||""),1)):u("",!0)])])):u("",!0),t("div",null,[e[13]||(e[13]=t("h4",{class:"text-sm font-medium text-muted-foreground mb-2"},"Информация о заявке",-1)),t("div",et,[t("div",null,[e[6]||(e[6]=t("label",{class:"block text-xs text-muted-foreground mb-1"},"Имя",-1)),t("p",ot,a(d.consultation.name),1)]),t("div",null,[e[7]||(e[7]=t("label",{class:"block text-xs text-muted-foreground mb-1"},"Телефон",-1)),t("p",st,a(d.consultation.phone),1)]),d.consultation.description?(r(),l("div",nt,[e[8]||(e[8]=t("label",{class:"block text-xs text-muted-foreground mb-1"},"Описание",-1)),t("p",rt,a(d.consultation.description),1)])):u("",!0),t("div",null,[e[10]||(e[10]=t("label",{class:"block text-xs text-muted-foreground mb-1"},"Статус",-1)),v(t("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>o.form.status=s),class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},[...e[9]||(e[9]=[t("option",{value:"new"},"Новая",-1),t("option",{value:"in_progress"},"В работе",-1),t("option",{value:"closed"},"Закрыта",-1)])],512),[[q,o.form.status]])]),t("div",null,[e[11]||(e[11]=t("label",{class:"block text-xs text-muted-foreground mb-1"},"Примечания администратора",-1)),v(t("textarea",{"onUpdate:modelValue":e[2]||(e[2]=s=>o.form.admin_notes=s),rows:"4",class:"w-full px-3 py-2 border border-border rounded-lg bg-background resize-none",placeholder:"Введите примечания..."},null,512),[[w,o.form.admin_notes]])]),t("div",null,[e[12]||(e[12]=t("label",{class:"block text-xs text-muted-foreground mb-1"},"Дата создания",-1)),t("p",lt,a(o.formatDate(d.consultation.created_at)),1)])])]),t("div",dt,[t("button",{onClick:e[3]||(e[3]=s=>c.$emit("close")),class:"flex-1 h-10 px-4 border border-border bg-background/50 hover:bg-accent/10 rounded-lg"}," Отмена "),t("button",{onClick:e[4]||(e[4]=(...s)=>o.saveConsultation&&o.saveConsultation(...s)),disabled:o.saving,class:"flex-1 h-10 px-4 bg-accent/10 backdrop-blur-xl text-accent border border-accent/40 hover:bg-accent/20 rounded-lg disabled:opacity-50"},a(o.saving?"Сохранение...":"Сохранить"),9,at)])])])])}const ct=I(R,[["render",it]]),ut={name:"ConsultationTable",components:{ConsultationDetail:ct},props:{botId:{type:[String,Number],required:!0}},setup(c){const e=g(!1),d=g([]),o=g(null),i=g(1),f=g(20),s=g(0),n=g({status:"",date_from:"",date_to:""}),b=async()=>{e.value=!0;try{const y={page:i.value,per_page:f.value,...n.value},T=await B(`/bot-management/${c.botId}/consultations`,y);if(!T.ok)throw new Error("Ошибка загрузки заявок");const j=await T.json();d.value=j.data.consultations||[],s.value=j.data.total||0}catch(y){console.error("Error fetching consultations:",y)}finally{e.value=!1}},x=()=>{n.value={status:"",date_from:"",date_to:""},i.value=1,b()},m=y=>{o.value=y},_=y=>({new:"Новая",in_progress:"В работе",closed:"Закрыта"})[y]||y,k=y=>({new:"bg-blue-500/10 text-blue-500",in_progress:"bg-yellow-500/10 text-yellow-500",closed:"bg-green-500/10 text-green-500"})[y]||"bg-gray-500/10 text-gray-500",h=y=>new Date(y).toLocaleDateString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"});return P(i,()=>{b()}),M(()=>{b()}),{loading:e,consultations:d,selectedConsultation:o,currentPage:i,perPage:f,total:s,filters:n,fetchConsultations:b,resetFilters:x,showDetail:m,getStatusLabel:_,getStatusClass:k,formatDate:h}}},bt={class:"consultation-table space-y-4"},mt={class:"bg-muted/30 rounded-lg border border-border p-4"},gt={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},ft={class:"flex items-end"},xt={key:0,class:"text-center py-12"},_t={key:1,class:"bg-background rounded-lg border border-border overflow-hidden"},pt={class:"overflow-x-auto"},vt={class:"w-full"},yt={class:"divide-y divide-border"},ht={class:"px-6 py-4 text-sm"},kt={class:"px-6 py-4 text-sm"},wt={class:"px-6 py-4 text-sm"},Ct={class:"px-6 py-4"},St={class:"px-6 py-4 text-sm"},Bt={class:"px-6 py-4 text-right"},It=["onClick"],Dt={key:0,class:"px-6 py-4 border-t border-border flex items-center justify-between"},Mt={class:"text-sm text-muted-foreground"},Tt={class:"flex gap-2"},Ut=["disabled"],jt=["disabled"];function $t(c,e,d,o,i,f){const s=D("ConsultationDetail");return r(),l("div",bt,[e[16]||(e[16]=t("div",{class:"flex items-center justify-between"},[t("h2",{class:"text-2xl font-semibold"},"Заявки на консультацию")],-1)),t("div",mt,[t("div",gt,[t("div",null,[e[11]||(e[11]=t("label",{class:"block text-sm font-medium mb-2"},"Статус",-1)),v(t("select",{"onUpdate:modelValue":e[0]||(e[0]=n=>o.filters.status=n),onChange:e[1]||(e[1]=(...n)=>o.fetchConsultations&&o.fetchConsultations(...n)),class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},[...e[10]||(e[10]=[t("option",{value:""},"Все",-1),t("option",{value:"new"},"Новые",-1),t("option",{value:"in_progress"},"В работе",-1),t("option",{value:"closed"},"Закрытые",-1)])],544),[[q,o.filters.status]])]),t("div",null,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium mb-2"},"Дата от",-1)),v(t("input",{"onUpdate:modelValue":e[2]||(e[2]=n=>o.filters.date_from=n),type:"date",onChange:e[3]||(e[3]=(...n)=>o.fetchConsultations&&o.fetchConsultations(...n)),class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},null,544),[[w,o.filters.date_from]])]),t("div",null,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium mb-2"},"Дата до",-1)),v(t("input",{"onUpdate:modelValue":e[4]||(e[4]=n=>o.filters.date_to=n),type:"date",onChange:e[5]||(e[5]=(...n)=>o.fetchConsultations&&o.fetchConsultations(...n)),class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},null,544),[[w,o.filters.date_to]])]),t("div",ft,[t("button",{onClick:e[6]||(e[6]=(...n)=>o.resetFilters&&o.resetFilters(...n)),class:"w-full h-10 px-4 border border-border bg-background hover:bg-muted/10 rounded-lg"}," Сбросить ")])])]),o.loading?(r(),l("div",xt,[...e[14]||(e[14]=[t("p",{class:"text-muted-foreground"},"Загрузка заявок...",-1)])])):u("",!0),o.loading?u("",!0):(r(),l("div",_t,[t("div",pt,[t("table",vt,[e[15]||(e[15]=t("thead",{class:"bg-muted/30 border-b border-border"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase"},"ID"),t("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase"},"Имя"),t("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase"},"Телефон"),t("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase"},"Статус"),t("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase"},"Дата"),t("th",{class:"px-6 py-3 text-right text-xs font-medium uppercase"},"Действия")])],-1)),t("tbody",yt,[(r(!0),l(C,null,S(o.consultations,n=>(r(),l("tr",{key:n.id,class:"hover:bg-muted/10"},[t("td",ht,a(n.id),1),t("td",kt,a(n.name),1),t("td",wt,a(n.phone),1),t("td",Ct,[t("span",{class:V(["px-2 py-1 text-xs rounded-md",o.getStatusClass(n.status)])},a(o.getStatusLabel(n.status)),3)]),t("td",St,a(o.formatDate(n.created_at)),1),t("td",Bt,[t("button",{onClick:b=>o.showDetail(n),class:"px-3 py-1 text-xs bg-blue-500 hover:bg-blue-600 text-white rounded"}," Детали ",8,It)])]))),128))])])]),o.total>o.perPage?(r(),l("div",Dt,[t("div",Mt," Показано "+a((o.currentPage-1)*o.perPage+1)+" - "+a(Math.min(o.currentPage*o.perPage,o.total))+" из "+a(o.total),1),t("div",Tt,[t("button",{onClick:e[7]||(e[7]=n=>o.currentPage--),disabled:o.currentPage===1,class:"px-4 py-2 border border-border rounded-lg disabled:opacity-50"}," Назад ",8,Ut),t("button",{onClick:e[8]||(e[8]=n=>o.currentPage++),disabled:o.currentPage*o.perPage>=o.total,class:"px-4 py-2 border border-border rounded-lg disabled:opacity-50"}," Вперед ",8,jt)])])):u("",!0)])),o.selectedConsultation?(r(),F(s,{key:2,consultation:o.selectedConsultation,"bot-id":d.botId,onClose:e[9]||(e[9]=n=>o.selectedConsultation=null),onUpdated:o.fetchConsultations},null,8,["consultation","bot-id","onUpdated"])):u("",!0)])}const qt=I(ut,[["render",$t]]),Vt={name:"MaterialCategoryTree",props:{botId:{type:[String,Number],required:!0}},setup(c){const e=g(!1),d=g([]),o=g(!1),i=async()=>{e.value=!0;try{const _=await B(`/bot-management/${c.botId}/materials/categories`);if(!_.ok)throw new Error("Ошибка загрузки категорий");const k=await _.json();d.value=k.data||[];for(const h of d.value)await f(h)}catch(_){console.error("Error fetching categories:",_)}finally{e.value=!1}},f=async _=>{try{const k=await B(`/bot-management/${c.botId}/materials`,{category_id:_.id});if(k.ok){const h=await k.json();_.materials=h.data||[]}}catch(k){console.error("Error fetching materials:",k)}},s=async _=>{if((await p.fire({title:"Удалить категорию?",text:`Категория "${_.name}" и все её материалы будут удалены.`,icon:"warning",showCancelButton:!0,confirmButtonText:"Удалить",cancelButtonText:"Отмена"})).isConfirmed)try{if(!(await $(`/bot-management/${c.botId}/materials/categories/${_.id}`)).ok)throw new Error("Ошибка удаления категории");await p.fire({title:"Удалено",icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"}),i()}catch(h){p.fire({title:"Ошибка",text:h.message||"Ошибка удаления категории",icon:"error"})}},n=async _=>{if((await p.fire({title:"Удалить материал?",text:`Материал "${_.title}" будет удален.`,icon:"warning",showCancelButton:!0,confirmButtonText:"Удалить",cancelButtonText:"Отмена"})).isConfirmed)try{if(!(await $(`/bot-management/${c.botId}/materials/${_.id}`)).ok)throw new Error("Ошибка удаления материала");await p.fire({title:"Удалено",icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"}),i()}catch(h){p.fire({title:"Ошибка",text:h.message||"Ошибка удаления материала",icon:"error"})}},b=_=>{p.fire({title:"В разработке",text:"Редактирование категорий будет доступно в следующей версии",icon:"info"})},x=_=>{p.fire({title:"В разработке",text:"Редактирование материалов будет доступно в следующей версии",icon:"info"})},m=_=>{p.fire({title:"В разработке",text:"Создание материалов будет доступно в следующей версии",icon:"info"})};return M(()=>{i()}),{loading:e,categories:d,showCategoryModal:o,fetchCategories:i,deleteCategory:s,deleteMaterial:n,editCategory:b,editMaterial:x,showMaterialModal:m}}},Et={class:"material-category-tree space-y-4"},Pt={class:"flex items-center justify-between"},Ft={key:0,class:"text-center py-12"},Nt={key:1,class:"space-y-4"},At={class:"flex items-center justify-between mb-4"},Lt={class:"text-lg font-semibold"},zt={key:0,class:"text-sm text-muted-foreground mt-1"},Rt={class:"flex gap-2"},Gt=["onClick"],Ot=["onClick"],Ht=["onClick"],Jt={key:0,class:"space-y-2"},Kt={class:"font-medium"},Qt={key:0,class:"text-sm text-muted-foreground"},Wt={class:"text-xs text-muted-foreground"},Xt={class:"flex gap-2"},Yt=["onClick"],Zt=["onClick"],te={key:1,class:"text-sm text-muted-foreground p-3"},ee={key:0,class:"text-center py-12 text-muted-foreground"};function oe(c,e,d,o,i,f){return r(),l("div",Et,[t("div",Pt,[e[1]||(e[1]=t("h2",{class:"text-2xl font-semibold"},"Материалы",-1)),t("button",{onClick:e[0]||(e[0]=s=>o.showCategoryModal=!0),class:"h-11 px-6 bg-accent/10 backdrop-blur-xl text-accent border border-accent/40 hover:bg-accent/20 rounded-2xl"}," + Добавить категорию ")]),o.loading?(r(),l("div",Ft,[...e[2]||(e[2]=[t("p",{class:"text-muted-foreground"},"Загрузка материалов...",-1)])])):u("",!0),o.loading?u("",!0):(r(),l("div",Nt,[(r(!0),l(C,null,S(o.categories,s=>(r(),l("div",{key:s.id,class:"bg-card rounded-lg border border-border p-4"},[t("div",At,[t("div",null,[t("h3",Lt,a(s.name),1),s.description?(r(),l("p",zt,a(s.description),1)):u("",!0)]),t("div",Rt,[t("button",{onClick:n=>o.editCategory(s),class:"px-3 py-1 text-xs bg-yellow-500 hover:bg-yellow-600 text-white rounded"}," Редактировать ",8,Gt),t("button",{onClick:n=>o.deleteCategory(s),class:"px-3 py-1 text-xs bg-red-500 hover:bg-red-600 text-white rounded"}," Удалить ",8,Ot),t("button",{onClick:n=>o.showMaterialModal(s),class:"px-3 py-1 text-xs bg-green-500 hover:bg-green-600 text-white rounded"}," + Материал ",8,Ht)])]),s.materials&&s.materials.length>0?(r(),l("div",Jt,[(r(!0),l(C,null,S(s.materials,n=>(r(),l("div",{key:n.id,class:"flex items-center justify-between p-3 bg-muted/30 rounded-lg"},[t("div",null,[t("p",Kt,a(n.title),1),n.description?(r(),l("p",Qt,a(n.description),1)):u("",!0),t("p",Wt," Скачиваний: "+a(n.download_count||0),1)]),t("div",Xt,[t("button",{onClick:b=>o.editMaterial(n),class:"px-3 py-1 text-xs bg-blue-500 hover:bg-blue-600 text-white rounded"}," Редактировать ",8,Yt),t("button",{onClick:b=>o.deleteMaterial(n),class:"px-3 py-1 text-xs bg-red-500 hover:bg-red-600 text-white rounded"}," Удалить ",8,Zt)])]))),128))])):(r(),l("div",te," Нет материалов "))]))),128)),o.categories.length===0?(r(),l("div",ee," Категории не найдены. Создайте первую категорию. ")):u("",!0)]))])}const se=I(Vt,[["render",oe]]),ne={name:"BotSettingsForm",props:{botId:{type:[String,Number],required:!0}},emits:["updated"],setup(c,{emit:e}){const d=g(!1),o=g(!1),i=g({required_channel_id:null,required_channel_username:"",admin_telegram_ids:[],yandex_maps_url:"",welcome_message:"",other_settings:{phone_validation_strict:!1,max_description_length:1e3,subscription_check_timeout:5}}),f=async()=>{d.value=!0;try{const x=await B(`/bot-management/${c.botId}/settings`);if(!x.ok)throw new Error("Ошибка загрузки настроек");const m=await x.json();m.success&&m.data&&(i.value={required_channel_id:m.data.required_channel_id||null,required_channel_username:m.data.required_channel_username||"",admin_telegram_ids:m.data.admin_telegram_ids||[],yandex_maps_url:m.data.yandex_maps_url||"",welcome_message:m.data.welcome_message||"",other_settings:m.data.settings?.other_settings||{phone_validation_strict:!1,max_description_length:1e3,subscription_check_timeout:5}})}catch(x){console.error("Error fetching settings:",x)}finally{d.value=!1}},s=async()=>{o.value=!0;try{const x=await E(`/bot-management/${c.botId}/settings`,{...i.value,settings:{other_settings:i.value.other_settings}});if(!x.ok){const m=await x.json().catch(()=>({}));throw new Error(m.message||"Ошибка сохранения настроек")}await p.fire({title:"Сохранено",icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"}),e("updated")}catch(x){p.fire({title:"Ошибка",text:x.message||"Ошибка сохранения настроек",icon:"error",confirmButtonText:"ОК"})}finally{o.value=!1}},n=()=>{i.value.admin_telegram_ids.push(null)},b=x=>{i.value.admin_telegram_ids.splice(x,1)};return M(()=>{f()}),{loading:d,saving:o,form:i,fetchSettings:f,saveSettings:s,addAdmin:n,removeAdmin:b}}},re={class:"bot-settings-form space-y-6"},le={class:"bg-card rounded-lg border border-border p-6 space-y-4"},de={class:"space-y-2"},ae=["onUpdate:modelValue"],ie=["onClick"],ce={class:"bg-card rounded-lg border border-border p-6 space-y-4"},ue={class:"flex items-center gap-2"},be={class:"flex gap-4"},me=["disabled"];function ge(c,e,d,o,i,f){return r(),l("div",re,[e[21]||(e[21]=t("h2",{class:"text-2xl font-semibold"},"Настройки бота",-1)),t("form",{onSubmit:e[8]||(e[8]=A((...s)=>o.saveSettings&&o.saveSettings(...s),["prevent"])),class:"space-y-6"},[t("div",le,[e[16]||(e[16]=t("h3",{class:"text-lg font-semibold"},"Основные настройки",-1)),t("div",null,[e[9]||(e[9]=t("label",{class:"block text-sm font-medium mb-2"},"ID канала",-1)),v(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>o.form.required_channel_id=s),type:"number",placeholder:"-1001234567890",class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},null,512),[[w,o.form.required_channel_id,void 0,{number:!0}]]),e[10]||(e[10]=t("p",{class:"text-xs text-muted-foreground mt-1"}," ID канала (можно получить через бота @userinfobot) ",-1))]),t("div",null,[e[11]||(e[11]=t("label",{class:"block text-sm font-medium mb-2"},"Username канала",-1)),v(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>o.form.required_channel_username=s),type:"text",placeholder:"aip_channel",class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},null,512),[[w,o.form.required_channel_username]]),e[12]||(e[12]=t("p",{class:"text-xs text-muted-foreground mt-1"}," Username канала без символа @ ",-1))]),t("div",null,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium mb-2"},"Telegram ID администраторов",-1)),t("div",de,[(r(!0),l(C,null,S(o.form.admin_telegram_ids,(s,n)=>(r(),l("div",{key:n,class:"flex gap-2"},[v(t("input",{"onUpdate:modelValue":b=>o.form.admin_telegram_ids[n]=b,type:"number",placeholder:"123456789",class:"flex-1 h-10 px-3 border border-border rounded-lg bg-background"},null,8,ae),[[w,o.form.admin_telegram_ids[n],void 0,{number:!0}]]),t("button",{type:"button",onClick:b=>o.removeAdmin(n),class:"px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg"}," Удалить ",8,ie)]))),128)),t("button",{type:"button",onClick:e[2]||(e[2]=(...s)=>o.addAdmin&&o.addAdmin(...s)),class:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg"}," + Добавить администратора ")])]),t("div",null,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium mb-2"},"Ссылка на Яндекс Карты",-1)),v(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>o.form.yandex_maps_url=s),type:"url",placeholder:"https://yandex.ru/maps/org/...",class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},null,512),[[w,o.form.yandex_maps_url]])]),t("div",null,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium mb-2"},"Приветственное сообщение",-1)),v(t("textarea",{"onUpdate:modelValue":e[4]||(e[4]=s=>o.form.welcome_message=s),rows:"6",placeholder:"Добро пожаловать...",class:"w-full px-3 py-2 border border-border rounded-lg bg-background resize-none"},null,512),[[w,o.form.welcome_message]])])]),t("div",ce,[e[20]||(e[20]=t("h3",{class:"text-lg font-semibold"},"Дополнительные настройки",-1)),t("div",null,[t("label",ue,[v(t("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>o.form.other_settings.phone_validation_strict=s),type:"checkbox",class:"w-4 h-4"},null,512),[[N,o.form.other_settings.phone_validation_strict]]),e[17]||(e[17]=t("span",null,"Строгая валидация телефона",-1))])]),t("div",null,[e[18]||(e[18]=t("label",{class:"block text-sm font-medium mb-2"},"Максимальная длина описания",-1)),v(t("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>o.form.other_settings.max_description_length=s),type:"number",min:"10",max:"5000",class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},null,512),[[w,o.form.other_settings.max_description_length,void 0,{number:!0}]])]),t("div",null,[e[19]||(e[19]=t("label",{class:"block text-sm font-medium mb-2"},"Таймаут проверки подписки (сек)",-1)),v(t("input",{"onUpdate:modelValue":e[7]||(e[7]=s=>o.form.other_settings.subscription_check_timeout=s),type:"number",min:"1",max:"30",class:"w-full h-10 px-3 border border-border rounded-lg bg-background"},null,512),[[w,o.form.other_settings.subscription_check_timeout,void 0,{number:!0}]])])]),t("div",be,[t("button",{type:"submit",disabled:o.saving,class:"flex-1 h-11 px-6 bg-accent/10 backdrop-blur-xl text-accent border border-accent/40 hover:bg-accent/20 rounded-2xl disabled:opacity-50"},a(o.saving?"Сохранение...":"Сохранить настройки"),9,me)])],32)])}const fe=I(ne,[["render",ge]]),xe={name:"BotStatistics",props:{botId:{type:[String,Number],required:!0}},setup(c){const e=g(!1),d=g(null),o=async()=>{e.value=!0;try{const i=await B(`/bot-management/${c.botId}/statistics`);if(!i.ok)throw new Error("Ошибка загрузки статистики");const f=await i.json();f.success&&f.data&&(d.value=f.data)}catch(i){console.error("Error fetching statistics:",i)}finally{e.value=!1}};return M(()=>{o()}),{loading:e,statistics:d}}},_e={class:"bot-statistics space-y-6"},pe={key:0,class:"text-center py-12"},ve={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},ye={class:"bg-card rounded-lg border border-border p-6"},he={class:"text-3xl font-semibold"},ke={class:"bg-card rounded-lg border border-border p-6"},we={class:"text-3xl font-semibold"},Ce={class:"bg-card rounded-lg border border-border p-6"},Se={class:"text-3xl font-semibold"},Be={class:"bg-card rounded-lg border border-border p-6"},Ie={class:"text-3xl font-semibold"},De={key:2,class:"bg-card rounded-lg border border-border p-6"},Me={class:"grid grid-cols-3 gap-4"},Te={class:"text-2xl font-semibold"},Ue={class:"text-2xl font-semibold"},je={class:"text-2xl font-semibold"},$e={key:3,class:"bg-card rounded-lg border border-border p-6"},qe={class:"space-y-2"},Ve={class:"font-medium"},Ee={class:"text-sm text-muted-foreground"};function Pe(c,e,d,o,i,f){return r(),l("div",_e,[e[10]||(e[10]=t("h2",{class:"text-2xl font-semibold"},"Статистика",-1)),o.loading?(r(),l("div",pe,[...e[0]||(e[0]=[t("p",{class:"text-muted-foreground"},"Загрузка статистики...",-1)])])):u("",!0),!o.loading&&o.statistics?(r(),l("div",ve,[t("div",ye,[e[1]||(e[1]=t("h3",{class:"text-sm font-medium text-muted-foreground mb-2"},"Всего пользователей",-1)),t("p",he,a(o.statistics.total_users||0),1)]),t("div",ke,[e[2]||(e[2]=t("h3",{class:"text-sm font-medium text-muted-foreground mb-2"},"Активных за 30 дней",-1)),t("p",we,a(o.statistics.active_users_30d||0),1)]),t("div",Ce,[e[3]||(e[3]=t("h3",{class:"text-sm font-medium text-muted-foreground mb-2"},"Всего заявок",-1)),t("p",Se,a(o.statistics.total_consultations||0),1)]),t("div",Be,[e[4]||(e[4]=t("h3",{class:"text-sm font-medium text-muted-foreground mb-2"},"Скачиваний материалов",-1)),t("p",Ie,a(o.statistics.materials_downloads||0),1)])])):u("",!0),!o.loading&&o.statistics?(r(),l("div",De,[e[8]||(e[8]=t("h3",{class:"text-lg font-semibold mb-4"},"Заявки по статусам",-1)),t("div",Me,[t("div",null,[e[5]||(e[5]=t("p",{class:"text-sm text-muted-foreground"},"Новые",-1)),t("p",Te,a(o.statistics.consultations_by_status?.new||0),1)]),t("div",null,[e[6]||(e[6]=t("p",{class:"text-sm text-muted-foreground"},"В работе",-1)),t("p",Ue,a(o.statistics.consultations_by_status?.in_progress||0),1)]),t("div",null,[e[7]||(e[7]=t("p",{class:"text-sm text-muted-foreground"},"Закрытые",-1)),t("p",je,a(o.statistics.consultations_by_status?.closed||0),1)])])])):u("",!0),!o.loading&&o.statistics&&o.statistics.popular_materials?.length>0?(r(),l("div",$e,[e[9]||(e[9]=t("h3",{class:"text-lg font-semibold mb-4"},"Популярные материалы",-1)),t("div",qe,[(r(!0),l(C,null,S(o.statistics.popular_materials,s=>(r(),l("div",{key:s.id,class:"flex items-center justify-between p-3 bg-muted/30 rounded-lg"},[t("p",Ve,a(s.title),1),t("p",Ee,a(s.download_count||0)+" скачиваний",1)]))),128))])])):u("",!0)])}const Fe=I(xe,[["render",Pe]]),Ne={name:"BotManagement",components:{ConsultationTable:qt,MaterialCategoryTree:se,BotSettingsForm:fe,BotStatistics:Fe},setup(){const c=z(),e=L(()=>c.params.botId),d=g(!1),o=g(null),i=g(null),f=g("consultations"),s=[{key:"consultations",label:"Заявки"},{key:"materials",label:"Материалы"},{key:"settings",label:"Настройки"},{key:"statistics",label:"Статистика"}],n=async()=>{d.value=!0,o.value=null;try{const b=await B(`/bots/${e.value}`);if(!b.ok){const m=await b.json().catch(()=>({}));throw new Error(m.message||"Ошибка загрузки бота")}const x=await b.json();i.value=x.data||null}catch(b){o.value=b.message||"Ошибка загрузки бота"}finally{d.value=!1}};return M(()=>{n()}),{botId:e,loading:d,error:o,bot:i,activeTab:f,tabs:s,fetchBot:n}}},Ae={class:"bot-management-page space-y-6"},Le={class:"flex items-center justify-between"},ze={key:0,class:"text-muted-foreground mt-1"},Re={key:0,class:"flex items-center justify-center py-12"},Ge={key:1,class:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg"},Oe={class:"text-destructive"},He={key:2,class:"bg-card rounded-lg border border-border"},Je={class:"border-b border-border"},Ke={class:"flex -mb-px"},Qe=["onClick"],We={class:"p-6"},Xe={key:0},Ye={key:1},Ze={key:2},to={key:3};function eo(c,e,d,o,i,f){const s=D("ConsultationTable"),n=D("MaterialCategoryTree"),b=D("BotSettingsForm"),x=D("BotStatistics");return r(),l("div",Ae,[t("div",Le,[t("div",null,[e[1]||(e[1]=t("h1",{class:"text-3xl font-semibold text-foreground"},"Управление ботом",-1)),o.bot?(r(),l("p",ze,a(o.bot.name),1)):u("",!0)]),t("button",{onClick:e[0]||(e[0]=m=>c.$router.push({name:"admin.bots"})),class:"h-11 px-6 bg-accent/10 backdrop-blur-xl text-accent border border-accent/40 hover:bg-accent/20 rounded-2xl shadow-lg shadow-accent/10 inline-flex items-center justify-center gap-2"}," ← Назад к ботам ")]),o.loading?(r(),l("div",Re,[...e[2]||(e[2]=[t("p",{class:"text-muted-foreground"},"Загрузка данных...",-1)])])):u("",!0),o.error?(r(),l("div",Ge,[t("p",Oe,a(o.error),1)])):u("",!0),!o.loading&&o.bot?(r(),l("div",He,[t("div",Je,[t("nav",Ke,[(r(!0),l(C,null,S(o.tabs,m=>(r(),l("button",{key:m.key,onClick:_=>o.activeTab=m.key,class:V(["px-6 py-4 text-sm font-medium border-b-2 transition-colors",o.activeTab===m.key?"border-accent text-accent":"border-transparent text-muted-foreground hover:text-foreground hover:border-muted-foreground"])},a(m.label),11,Qe))),128))])]),t("div",We,[o.activeTab==="consultations"?(r(),l("div",Xe,[U(s,{"bot-id":o.botId},null,8,["bot-id"])])):u("",!0),o.activeTab==="materials"?(r(),l("div",Ye,[U(n,{"bot-id":o.botId},null,8,["bot-id"])])):u("",!0),o.activeTab==="settings"?(r(),l("div",Ze,[U(b,{"bot-id":o.botId,onUpdated:o.fetchBot},null,8,["bot-id","onUpdated"])])):u("",!0),o.activeTab==="statistics"?(r(),l("div",to,[U(x,{"bot-id":o.botId},null,8,["bot-id"])])):u("",!0)])])):u("",!0)])}const ro=I(Ne,[["render",eo]]);export{ro as default};
